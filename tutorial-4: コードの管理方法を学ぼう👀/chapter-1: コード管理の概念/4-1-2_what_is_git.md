# Tutorial 4-1-2: Gitとは何か

## 🎯 このセクションで学ぶこと

*   バージョン管理システム「Git」の基本的な概念と役割を理解する。
*   Gitが「分散型」バージョン管理システムと呼ばれる理由を理解する。
*   Gitにおける3つの重要なエリア（ワーキングツリー、ステージ、リポジトリ）の概念を理解する。

---

## 導入

前のセクションで、私たちはバージョン管理の重要性を学びました。では、具体的にどのツールを使えば、その恩恵を受けられるのでしょうか？その答えが、今回学ぶ**Git（ギット）**です。

Gitは、2005年に、Linuxカーネルの開発者であるリーナス・トーバルズによって開発された、オープンソースのバージョン管理システムです。現在、世界中のソフトウェア開発プロジェクトの、実に90%以上で採用されており [1]、バージョン管理システムの「事実上の標準（デファクトスタンダード）」となっています。

あなたがこれからエンジニアとしてキャリアを歩んでいく上で、Gitを使いこなすことは、もはや選択肢ではなく、**必須のスキル**です。しかし、心配する必要はありません。Gitの基本的な考え方は、非常にシンプルです。このセクションで、その核心となる概念を、分かりやすい比喩と共に学んでいきましょう。

---

## 概念の説明

### 📜 Gitの基本的な考え方: 「変更」を記録するタイムマシン

Gitの最も基本的な役割は、ファイルそのものではなく、**ファイルの「変更」を記録し続ける**ことです。Gitは、プロジェクトの歴史を、一連の「スナップショット（ある時点での写真）」として保存します。

これを、セーブポイントのあるゲームに例えてみましょう。

1.  ゲームを開始し、最初の村に到着します。（最初のファイルをいくつか作成）
2.  ここで、**セーブポイント1**に記録します。（最初の「コミット」）
3.  次に、隣の森を探検し、新しいアイテムを手に入れます。（いくつかのファイルを編集）
4.  森の出口で、**セーブポイント2**に記録します。（2回目の「コミット」）
5.  その後、強力なボスに挑みましたが、残念ながら負けてしまいました。

こんな時、あなたならどうしますか？もちろん、最後にセーブした「セーブポイント2」から、ゲームを再開しますよね。Gitを使えば、これと全く同じことができます。何か問題が起きた時に、いつでも安全な「セーブポイント（コミット）」まで、プロジェクトの状態を戻すことができるのです。

### 🌐 分散型バージョン管理システム

Gitが他の多くのバージョン管理システムと大きく異なる点、それは「**分散型**」であるという特徴です。

従来の「集中型」バージョン管理システム（例えばSubversion）では、プロジェクトの全ての変更履歴は、中央にある一つの「親サーバー」にのみ保存されていました。開発者は、作業をする際に、常にその親サーバーに接続している必要がありました。

![集中型と分散型の違い](https://git-scm.com/images/centralized.png)
*図1: 集中型バージョン管理システム (Git SCMより) [2]*

一方、Gitのような「分散型」では、開発者一人ひとりが、自分のコンピュータ（ローカル環境）に、**プロジェクトの完全なコピー（全ての歴史を含むリポジトリ）**を持つことができます。

![分散型バージョン管理システム](https://git-scm.com/images/distributed.png)
*図2: 分散型バージョン管理システム (Git SCMより) [2]*

これにより、以下のような大きなメリットが生まれます。

*   **オフラインでの作業**: サーバーに接続していなくても、自分のローカル環境で、履歴の確認や変更の記録（コミット）ができます。
*   **高速な動作**: ほとんどの操作がローカルで完結するため、ネットワークの遅延がなく、非常に高速に動作します。
*   **高い冗長性**: もし中央のサーバーが故障しても、各開発者のローカルリポジトリから、簡単に復元することができます。

### 📦 Gitの3つのエリア

Gitを理解する上で、最も重要な概念が、**3つのエリア**です。Gitは、ファイルを以下の3つのエリアで管理します。

1.  **ワーキングツリー (Working Tree)**
2.  **ステージ (Stage) / インデックス (Index)**
3.  **リポジトリ (Repository)**

これを、「**引っ越しの荷造り**」に例えながら、実際にGitで扱うものと対応させて説明していきます。

![Gitの3つのエリア](https://git-scm.com/images/areas.png)
*図3: Gitの3つのエリア (Git SCMより) [2]*

---

#### 1. ワーキングツリー (Working Tree)

**🏠 比喩: 作業部屋**

ワーキングツリーは、あなたが今、実際にファイルを編集している「**作業部屋**」そのものです。引っ越しの準備をしている部屋で、まだ荷造りしていない荷物（ファイル）が散らばっている状態をイメージしてください。

**💻 実際に扱うもの: プロジェクトフォルダ**

ワーキングツリーとは、あなたのパソコン上にある**プロジェクトのフォルダそのもの**です。例えば、`my-project` というフォルダの中にある全てのファイルやサブフォルダが、ワーキングツリーに該当します。

```
my-project/          ← これがワーキングツリー
├── index.html       ← 自由に編集できるファイル
├── style.css        ← 自由に編集できるファイル
├── script.js        ← 自由に編集できるファイル
└── images/
    └── logo.png
```

ワーキングツリーにあるファイルは、VSCodeなどのエディタで自由に編集、作成、削除することができます。ここでの変更は、まだGitに「記録」されていません。あくまで「作業中」の状態です。

---

#### 2. ステージ (Stage) / インデックス (Index)

**📦 比喩: 段ボール箱**

ステージは、次のセーブポイント（コミット）に含めたい変更を、一時的に置いておくための「**段ボール箱**」です。作業部屋（ワーキングツリー）で変更したファイルの中から、「これは次の荷物として送りたい」と決めたものだけを、この段ボール箱に入れていきます。

**💻 実際に扱うもの: `.git/index` ファイル（隠しファイル）**

ステージは、プロジェクトフォルダ内の `.git` フォルダの中にある `index` という特殊なファイルで管理されています。ただし、このファイルを直接編集することはありません。Gitのコマンドを通じて操作します。

ステージに追加されたファイルは、「**次のコミットに含める準備ができた**」という状態になります。

```
【ワーキングツリーで変更したファイル】
├── index.html    (変更あり)
├── style.css     (変更あり)
└── script.js     (変更あり)

        ↓ index.html と style.css だけをステージに追加

【ステージに追加されたファイル】
├── index.html    ← 次のコミットに含まれる
└── style.css     ← 次のコミットに含まれる

【ステージに追加されていないファイル】
└── script.js     ← 次のコミットには含まれない
```

**なぜステージが必要なのか？**

それは、**コミットに含める変更を、自分で選択するため**です。例えば、ワーキングツリーでは、「ヘッダーのデザイン変更」と「ログイン機能のバグ修正」を、同時に行っていたとします。しかし、「ヘッダーのデザイン変更」だけを、先にセーブポイントとして記録したい、という場合があります。

そんな時に、ヘッダーに関する変更（`header.css`）だけをステージに追加することで、コミットの内容を論理的にまとめることができるのです。これにより、後から履歴を見返した時に、「このコミットでは何をしたのか」が明確になります。

---

#### 3. リポジトリ (Repository)

**🏢 比喩: 倉庫**

リポジトリは、ステージ（段ボール箱）に入れられた変更のスナップショットを、タイムスタンプやメッセージと共に、永久に保管しておくための「**倉庫**」です。段ボール箱の準備ができたら、「この荷物を発送してください」と、倉庫に送ります。

**💻 実際に扱うもの: `.git` フォルダ**

リポジトリは、プロジェクトフォルダ内の **`.git` フォルダ**そのものです。このフォルダの中に、プロジェクトの全ての変更履歴（コミット）が保存されています。

```
my-project/
├── .git/            ← これがリポジトリ（隠しフォルダ）
│   ├── objects/     ← 変更履歴のデータが保存されている
│   ├── refs/        ← ブランチやタグの情報
│   ├── HEAD         ← 現在のブランチを指す
│   └── ...
├── index.html
├── style.css
└── script.js
```

一度リポジトリに保管された変更（コミット）は、あなたが意図的に削除しない限り、消えることはありません。これが、あなたのプロジェクトの、安全なセーブポイントになります。

リポジトリには、以下の情報が記録されます：
*   **変更内容**: どのファイルが、どのように変更されたか
*   **タイムスタンプ**: いつ変更が記録されたか
*   **作成者**: 誰が変更を記録したか
*   **コミットメッセージ**: なぜその変更をしたのか（自分で書く説明文）

---

### 📊 3つのエリアのまとめ

| エリア | 比喩 | 実際に扱うもの | 役割 |
| :--- | :--- | :--- | :--- |
| **ワーキングツリー** | 作業部屋 | プロジェクトフォルダ（`my-project/`） | 実際にファイルを編集する場所 |
| **ステージ** | 段ボール箱 | `.git/index` ファイル | コミットする変更を一時的に置く場所 |
| **リポジトリ** | 倉庫 | `.git/` フォルダ | 変更の履歴を永久に保管する場所 |

### 🔄 3つのエリア間の流れ（ローカルでの作業）

Gitでファイルの変更を記録するには、以下の流れで作業を行います。

```
【ワーキングツリー】          【ステージ】            【リポジトリ】
   プロジェクトフォルダ    →    .git/index    →      .git/objects
   
   ファイルを編集         ステージに追加        コミットして記録
   （自由に作業）         （次に記録する        （永久に保存）
                          変更を選択）
```

**具体的な流れ:**

1.  **ワーキングツリーで作業**: VSCodeなどのエディタで、ファイルを編集・作成・削除します。
2.  **ステージに追加**: 編集したファイルの中から、次のコミットに含めたいものを選んでステージに追加します。
3.  **コミット**: ステージに追加された変更を、メッセージ（「何をしたか」の説明）と共にリポジトリに記録します。

この「編集 → ステージに追加 → コミット」のサイクルを繰り返すことで、プロジェクトの変更履歴が積み重なっていきます。

---

### 🌐 リモートリポジトリへの反映

ここまでの3つのエリアは、全てあなたのパソコン（ローカル環境）の中にあります。しかし、チームで共同作業をしたり、コードをバックアップしたりするためには、インターネット上のサーバー（リモートリポジトリ）にも変更を反映させる必要があります。

```
【ローカル環境（あなたのパソコン）】              【リモート環境（GitHub等）】

ワーキングツリー → ステージ → ローカルリポジトリ  →  リモートリポジトリ
                                                      （GitHub上の倉庫）
                              コミットした後に
                              「アップロード」して反映
```

**具体的な流れ:**

1.  **ローカルでコミット**: 上記の「編集 → ステージに追加 → コミット」の流れで、ローカルリポジトリに変更を記録します。
2.  **リモートにアップロード**: ローカルリポジトリに記録されたコミットを、GitHub等のリモートリポジトリにアップロードします。

このアップロードの操作を「**プッシュ（Push）**」と呼びます。プッシュすることで、あなたの変更がチームメンバーと共有されたり、クラウド上にバックアップされたりします。

| 操作 | 方向 | 説明 |
| :--- | :--- | :--- |
| **コミット** | ステージ → ローカルリポジトリ | 変更を自分のパソコンに記録 |
| **プッシュ** | ローカルリポジトリ → リモートリポジトリ | 記録した変更をGitHub等にアップロード |

> **ヒント**: 各エリア間でファイルを移動するための具体的なコマンドは、Chapter 3とChapter 4で詳しく学びます。今は、この流れを概念として理解しておいてください。

---

## ✨ まとめ

このセクションでは、バージョン管理システム「Git」の基本的な概念を学びました。

*   **Gitとは**: 世界で最も広く使われている、**分散型**のバージョン管理システム。
*   **Gitの役割**: プロジェクトの歴史を、一連の「スナップショット（コミット）」として記録するタイムマシン。
*   **分散型のメリット**: オフラインで作業でき、動作が高速で、冗長性が高い。
*   **Gitの3つのエリア**: 
    1.  **ワーキングツリー**: プロジェクトフォルダそのもの。実際にファイルを編集する場所。
    2.  **ステージ**: `.git/index` ファイル。コミットする変更を準備する場所。
    3.  **リポジトリ**: `.git/` フォルダ。変更の履歴を永久に保管する場所。

「ワーキングツリー → ステージ → リポジトリ」という流れは、Gitを使いこなす上で、最も基本となるワークフローです。次のセクションでは、Gitと密接に関連する「GitHub」について学びます。

---

## 📚 参考文献

[1] Stack Overflow. (2018). *Developer Survey Results 2018*. [https://insights.stackoverflow.com/survey/2018/#work-version-control](https://insights.stackoverflow.com/survey/2018/#work-version-control)

[2] Chacon, S., & Straub, B. (2014). *Pro Git*. Apress. [https://git-scm.com/book/en/v2](https://git-scm.com/book/en/v2)

---
