# Tutorial 12-1-1: APIとは何か

## 🎯 このセクションで学ぶこと

- API（Application Programming Interface）の概念を理解する
- Web APIの仕組みと役割を学ぶ
- **Web認証（Cookie/Session）とAPI認証（Token）の違い**を理解する

---

## 🧠 先輩エンジニアの思考プロセス

### 「なぜAPI開発を学ぶのか？」

Tutorial 12でWebアプリケーションを完成させました。次は「API開発」です。

| 理由 | 説明 |
|:---|:---|
| モダンな開発では必須 | フロントエンドとバックエンドが分離していることが多い |
| モバイルアプリとの連携 | スマートフォンアプリはAPIを通じてサーバーと通信する |
| 外部サービスとの連携 | 天気予報API、決済API、地図APIなどを利用 |

---

## Step 1: APIの基本概念

### 1-1. APIとは

**API（Application Programming Interface）**とは、**アプリケーション同士が通信するための仕組み**です。

APIを使うことで、以下のようなことが可能になります。

| 用途 | 説明 |
|:---|:---|
| フロントエンドとバックエンドの分離 | ReactやVue.jsとLaravelを連携 |
| モバイルアプリとの連携 | iOSやAndroidアプリからデータにアクセス |
| 外部サービスとの連携 | 天気予報API、決済API、地図APIなどを利用 |

### 1-2. Web APIとは

**Web API**とは、**HTTPプロトコルを使って通信するAPI**です。

| 特徴 | 説明 |
|:---|:---|
| HTTPメソッドを使う | GET、POST、PUT、DELETEなど |
| URLでリソースを指定 | `/api/tasks`、`/api/users/1`など |
| JSON形式でデータをやり取り | `{"id": 1, "title": "タスク1"}` |

---

## Step 2: RESTful APIの基礎

### 2-1. RESTful APIとは

**RESTful API**とは、**REST（Representational State Transfer）の原則に従ったAPI**です。

| 原則 | 説明 |
|:---|:---|
| リソース指向 | URLでリソースを表現する |
| HTTPメソッドを使う | GET、POST、PUT、DELETEなど |
| ステートレス | サーバーはクライアントの状態を保持しない |
| 統一されたインターフェース | 一貫性のあるURLとHTTPメソッドを使う |

### 2-2. RESTful APIの例

**タスク管理システムのAPI**

| HTTPメソッド | URL | 説明 |
|:---|:---|:---|
| GET | `/api/tasks` | タスク一覧を取得 |
| GET | `/api/tasks/1` | ID=1のタスクを取得 |
| POST | `/api/tasks` | タスクを作成 |
| PUT | `/api/tasks/1` | ID=1のタスクを更新 |
| DELETE | `/api/tasks/1` | ID=1のタスクを削除 |

### 2-3. HTTPメソッドの役割

| HTTPメソッド | 役割 | 例 |
|:---|:---|:---|
| GET | データを取得する | タスク一覧を取得 |
| POST | データを作成する | 新しいタスクを作成 |
| PUT | データを更新する | タスクを更新 |
| PATCH | データの一部を更新する | タスクのステータスのみを更新 |
| DELETE | データを削除する | タスクを削除 |

---

## Step 3: APIのレスポンス

### 3-1. JSON形式のレスポンス

APIは、通常**JSON形式**でデータを返します。

**例: タスク一覧のレスポンス**

```json
{
  "data": [
    {
      "id": 1,
      "title": "タスク1",
      "description": "これはタスク1です",
      "status": "pending",
      "due_date": "2024-12-31"
    },
    {
      "id": 2,
      "title": "タスク2",
      "description": "これはタスク2です",
      "status": "completed",
      "due_date": "2024-11-30"
    }
  ]
}
```

### 3-2. HTTPステータスコード

| ステータスコード | 意味 | 例 |
|:---|:---|:---|
| 200 | OK | リクエスト成功 |
| 201 | Created | リソースが作成された |
| 204 | No Content | リクエスト成功（レスポンスなし） |
| 400 | Bad Request | リクエストが不正 |
| 401 | Unauthorized | 認証が必要 |
| 403 | Forbidden | 権限がない |
| 404 | Not Found | リソースが見つからない |
| 422 | Unprocessable Entity | バリデーションエラー |
| 500 | Internal Server Error | サーバーエラー |

---

## 🗒️コラム: Web認証とAPI認証の違い（重要）

### 1. 認証方式の比較

Tutorial 10-12で学んだ**Web認証（Fortify）**と、API開発で使う**API認証（Token）**は、仕組みが大きく異なります。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Web認証（Cookie/Session）         　 　        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ブラウザ                        サーバー                        　│
│  ┌─────┐                        ┌─────────┐                     │
│  │     │  ①ログイン（ID/PW）　 　 │         │                     │
│  │     │ ─────────────────────> │         │                     │
│  │     │                        │ Session │                     │
│  │     │  ②Cookie（Session ID） │  保存  　│ 　　              　 │
│  │     │ <───────────────────── │         │                     │
│  │     │                        │         │                     │
│  │     │  ③リクエスト（Cookie自動送信）      │                     │
│  │     │ ─────────────────────> │ Session │                     │
│  │     │                        │  照合  　│                     │
│  └─────┘                        └─────────┘                     │
│                                                                 │
│  特徴：サーバーが状態（Session）を持つ「ステートフル」        　        │
│        ブラウザが自動でCookieを送信                         　      │
│        CSRF対策が必要                                      　     │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    API認証（Token）                　  　　 　 　  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  クライアント                    サーバー             　　          │
│  ┌─────┐                        ┌─────────┐                     │
│  │     │  ①ログイン（ID/PW）　　  │         │                     │
│  │     │ ─────────────────────> │         │                     │
│  │     │                        │         │                     │
│  │     │  ②Token発行            │         │                     │
│  │     │ <───────────────────── │         │                     │
│  │Token│                        │         │                     │
│  │ 保存 │  ③リクエスト          　│         │  　　   　           │
│  │     │  Authorization: Bearer xxx       │                     │
│  │     │ ─────────────────────> │ Token   │                     │
│  │     │                        │  検証 　 │  　　       　       │
│  └─────┘                        └─────────┘                     │
│                                                                 │
│  特徴：サーバーは状態を持たない「ステートレス」                  　　　　│
│        クライアントが明示的にTokenをヘッダーに付与               　　  │
│        スマホアプリや外部システム連携向け                          　 │
└─────────────────────────────────────────────────────────────────┘
```

### 2. 認証方式の詳細比較

| 項目 | Web認証（Cookie/Session） | API認証（Token） |
|:---|:---|:---|
| **状態管理** | ステートフル（サーバーがSessionを保持） | ステートレス（サーバーは状態を持たない） |
| **認証情報の送信** | ブラウザが自動でCookieを送信 | クライアントが明示的にヘッダーに付与 |
| **CSRF対策** | 必要（`@csrf`） | 不要（Cookieを使わないため） |
| **主な用途** | Webブラウザからのアクセス | スマホアプリ、外部システム連携 |
| **Laravel** | Fortify（セッション認証） | Sanctum（トークン認証） |

### 3. なぜ認証方式が異なるのか

**Web認証（ブラウザ向け）**：
- ブラウザは**自動的にCookieを送信**する仕組みがある
- そのため、悪意のあるサイトからの攻撃（CSRF）を防ぐ必要がある
- サーバー側でSessionを管理することで、セキュリティを確保

**API認証（アプリ向け）**：
- スマホアプリや外部システムは**Cookieを自動送信しない**
- クライアントが明示的にTokenをヘッダーに付与する必要がある
- サーバーはステートレスで、スケーラビリティが高い

> **📌 このカリキュラムでは**
> 
> API認証（Sanctum）の実装は扱いません。ここでは**概念の理解**に留め、Web認証との違いを把握することを目的とします。
> 
> 実際の開発では、要件に応じて適切な認証方式を選択します。

## ✨ まとめ

このセクションでは、APIの基本的な概念について学びました。

| Step | 学んだこと |
|:---|:---|
| Step 1 | APIの基本概念とWeb API |
| Step 2 | **Web認証とAPI認証の違い**（ステートフル vs ステートレス） |
| Step 3 | RESTful APIの原則とHTTPメソッド |
| Step 4 | JSON形式のレスポンスとHTTPステータスコード |

> **📌 重要なポイント**
> 
> - **Web認証（Fortify）**：ブラウザ向け、Cookie/Session、ステートフル
> - **API認証（Sanctum）**：アプリ向け、Token、ステートレス
> 
> このカリキュラムでは、API認証の実装は扱いません。概念を理解した上で、次のセクションではLaravelでAPIを開発する方法を学びます。

次のセクションでは、LaravelでAPIを開発する方法を学びます。

---
