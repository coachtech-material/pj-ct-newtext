# Tutorial 12-2-6: DELETE APIã®å®Ÿè£…ï¼ˆå‰Šé™¤ï¼‰

## ğŸ¯ ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å­¦ã¶ã“ã¨

- ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹DELETE APIã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆ204 No Contentã€404 Not Foundï¼‰ã‚’ç†è§£ã™ã‚‹
- ãªãœãã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã†ã®ã‹ã‚’å­¦ã¶
- 200 OKã¨204 No Contentã®é•ã„ã‚’ç†è§£ã™ã‚‹

---

## ğŸ§  å…ˆè¼©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹

### ã€Œãªãœæ›´æ–°APIã®å¾Œã«ã€å‰Šé™¤APIã€ã‚’å®Ÿè£…ã™ã‚‹ã®ã‹ï¼Ÿã€

æ›´æ–°APIãŒã§ããŸã‚‰ã€æ¬¡ã¯ã€Œå‰Šé™¤APIã€ã§ã™ã€‚

---

### ç†ç”±1: CRUDã®æœ€å¾Œ

CRUDï¼ˆCreate, Read, Update, Deleteï¼‰ã®æœ€å¾Œã¯ã€Œå‰Šé™¤ã€ã§ã™ã€‚

ã“ã‚Œã§CRUD APIãŒå®Œæˆã—ã¾ã™ã€‚

---

### ç†ç”±2: å‰Šé™¤ã¯æ…é‡ã«

å‰Šé™¤ã¯**å–ã‚Šæ¶ˆã—ãŒã§ããªã„**æ“ä½œã§ã™ã€‚

| è€ƒæ…®äº‹é … | èª¬æ˜ |
|----------|------|
| æœ¬å½“ã«å‰Šé™¤ã—ã¦ã„ã„ã‹ç¢ºèª | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| è«–ç†å‰Šé™¤ï¼ˆsoft deleteï¼‰ã®æ¤œè¨ | ãƒ‡ãƒ¼ã‚¿ã‚’æ®‹ã™å ´åˆ |
| é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç† | å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ |

---

### ç†ç”±3: é©åˆ‡ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹

å‰Šé™¤æˆåŠŸæ™‚ã¯ã€**204 No Content**ã‚’è¿”ã™ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚

```php
$task->delete();
return response()->json(null, 204);
```

---

### ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚„ã‚‹ã“ã¨

| é †ç•ª | ä½œæ¥­ | ç†ç”± |
|------|------|------|
| Step 1 | destroyãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£… | å‰Šé™¤ã®ãƒ­ã‚¸ãƒƒã‚¯ |
| Step 2 | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ | 204ã¨404ã®ä½¿ã„åˆ†ã‘ |
| Step 3 | å¿œç”¨ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ | ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆãªã© |

> ğŸ’¡ **ãƒã‚¤ãƒ³ãƒˆ**: DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€Œå‰Šé™¤ã€ã«ä½¿ã„ã¾ã™ã€‚

---

## Step 1: destroyãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

### 1-1. ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `DELETE /api/tasks/{id}`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼ˆæˆåŠŸæ™‚ï¼‰**:

- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: `204 No Content`
- ãƒœãƒ‡ã‚£: ãªã—

---

### 1-2. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/Http/Controllers/Api/TaskController.php`

```php
public function destroy(string $id): JsonResponse
{
    $task = Task::where('user_id', Auth::id())->find($id);
    
    if (!$task) {
        return response()->json([
            'message' => 'Task not found'
        ], 404);
    }
    
    $task->delete();
    
    return response()->json(null, 204);
}
```

---

### 1-3. ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

| ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|--------|------|
| `Task::where('user_id', Auth::id())->find($id)` | ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾— |
| `$task->delete()` | ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹ |
| `response()->json(null, 204)` | 204 No Contentã‚’è¿”ã™ |

---

## Step 2: HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

### 2-1. 204 No Content

**204 No Content**ã¯ã€**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ãŸãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ãŒãªã„**ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

| ä½¿ç”¨å ´é¢ | èª¬æ˜ |
|----------|------|
| ãƒªã‚½ãƒ¼ã‚¹ãŒæ­£å¸¸ã«å‰Šé™¤ã•ã‚ŒãŸ | ã‚¿ã‚¹ã‚¯ãŒå‰Šé™¤ã•ã‚ŒãŸ |
| å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ãŸãŒã€è¿”ã™ãƒ‡ãƒ¼ã‚¿ãŒãªã„ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¸è¦ |

```php
return response()->json(null, 204);
// ã¾ãŸã¯
return response()->noContent();
```

---

### 2-2. 404 Not Found

**404 Not Found**ã¯ã€**ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸ**ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

```php
return response()->json([
    'message' => 'Task not found'
], 404);
```

---

### 2-3. 200 OKã¨204 No Contentã®é•ã„

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ | ç”¨é€” |
|----------------|----------------|------|
| 200 OK | ã‚ã‚Š | å‰Šé™¤ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ |
| 204 No Content | ãªã— | å‰Šé™¤ãŒæˆåŠŸã—ãŸã“ã¨ã ã‘ã‚’ä¼ãˆã‚‹ |

**æ¨å¥¨**: DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ã€**204 No Content**ã‚’ä½¿ã†

---

### 2-4. Thunder Clientã§ãƒ†ã‚¹ãƒˆ

**1. æˆåŠŸã™ã‚‹å ´åˆ**

- ãƒ¡ã‚½ãƒƒãƒ‰: `DELETE`
- URL: `http://localhost:8000/api/tasks/1`
- æœŸå¾…: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ `204 No Content`

**2. ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ**

- ãƒ¡ã‚½ãƒƒãƒ‰: `DELETE`
- URL: `http://localhost:8000/api/tasks/9999`
- æœŸå¾…: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ `404 Not Found`

---

## Step 3: å¿œç”¨ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### 3-1. response()->noContent()ã‚’ä½¿ã†

Laravelã§ã¯ã€`response()->noContent()`ã‚’ä½¿ã†ã¨ã€204 No Contentã‚’è¿”ã›ã¾ã™ã€‚

```php
public function destroy(string $id): Response
{
    $task = Task::where('user_id', Auth::id())->findOrFail($id);
    $task->delete();
    
    return response()->noContent();
}
```

---

### 3-2. å‰Šé™¤ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™å ´åˆ

å‰Šé™¤ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™å ´åˆã¯ã€**200 OK**ã‚’ä½¿ã„ã¾ã™ã€‚

```php
public function destroy(string $id): JsonResponse
{
    $task = Task::where('user_id', Auth::id())->findOrFail($id);
    $deletedTask = $task->toArray();
    $task->delete();
    
    return response()->json([
        'message' => 'å‰Šé™¤ã—ã¾ã—ãŸ',
        'data' => $deletedTask
    ], 200);
}
```

---

### 3-3. ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆ

**ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆ**ã‚’ä½¿ã†ã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚’ç‰©ç†çš„ã«å‰Šé™¤ã›ãšã€è«–ç†çš„ã«å‰Šé™¤ã§ãã¾ã™ã€‚

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:

```php
$table->softDeletes();
```

**ãƒ¢ãƒ‡ãƒ«**:

```php
use Illuminate\Database\Eloquent\SoftDeletes;

class Task extends Model
{
    use SoftDeletes;
}
```

**å‰Šé™¤**:

```php
$task->delete(); // deleted_atã«æ—¥æ™‚ãŒè¨­å®šã•ã‚Œã‚‹
```

**å®Œå…¨å‰Šé™¤**:

```php
$task->forceDelete(); // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã‚‹
```

---

### 3-4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®å‡¦ç†ä¾‹ï¼ˆJavaScriptï¼‰

```javascript
fetch('http://localhost:8000/api/tasks/1', {
  method: 'DELETE',
})
  .then(response => {
    if (response.status === 204) {
      console.log('å‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
    } else if (response.status === 404) {
      return response.json().then(data => {
        throw new Error(data.message);
      });
    }
  })
  .catch(error => {
    console.error('ã‚¨ãƒ©ãƒ¼:', error);
  });
```

---

## ğŸš¨ ã‚ˆãã‚ã‚‹é–“é•ã„

### é–“é•ã„1: 200 OKã‚’è¿”ã™

**å•é¡Œ**: å‰Šé™¤ãŒæˆåŠŸã—ãŸå ´åˆã¯204ã‚’è¿”ã™ã®ãŒæ¨å¥¨

```php
// âŒ é–“é•ã„
return response()->json(['message' => 'Deleted'], 200);

// âœ… æ­£ã—ã„
return response()->noContent();
```

---

### é–“é•ã„2: 204ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’è¿”ã™

**å•é¡Œ**: 204 No Contentã®å ´åˆã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ãªã—

```php
// âŒ é–“é•ã„
return response()->json(['message' => 'Deleted'], 204);

// âœ… æ­£ã—ã„
return response()->json(null, 204);
```

---

### é–“é•ã„3: å­˜åœ¨ã—ãªã„ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã«200ã‚’è¿”ã™

**å•é¡Œ**: ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯404ã‚’è¿”ã™ã¹ã

```php
// âŒ é–“é•ã„
if (!$task) {
    return response()->json(['message' => 'Task not found'], 200);
}

// âœ… æ­£ã—ã„
if (!$task) {
    return response()->json(['message' => 'Task not found'], 404);
}
```

---

## ğŸ’¡ TIP: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®é‡è¦æ€§

é©åˆ‡ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™ã“ã¨ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã¾ã™ã€‚

| åˆ¤æ–­ | èª¬æ˜ |
|------|------|
| æˆåŠŸãƒ»å¤±æ•—ã‚’åˆ¤æ–­ã™ã‚‹ | 204ãªã‚‰å‰Šé™¤æˆåŠŸã€404ãªã‚‰ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ãªã„ |
| ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’è¡Œã† | 404ã®å ´åˆã¯ã€Œã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤º |
| ãƒªãƒˆãƒ©ã‚¤ã‚’åˆ¤æ–­ã™ã‚‹ | 404ã®å ´åˆã¯ãƒªãƒˆãƒ©ã‚¤ã—ãªã„ |

---

## âœ¨ ã¾ã¨ã‚

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹DELETE APIã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

| Step | å­¦ã‚“ã ã“ã¨ |
|------|-----------|
| Step 1 | destroyãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£… |
| Step 2 | 204 No Contentã¨404 Not Foundã®ä½¿ã„åˆ†ã‘ |
| Step 3 | ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆãªã©ã®å¿œç”¨ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ |

æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€è¦ªåˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä½œæˆã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚

---

## ğŸ“ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ

- [ ] ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹APIã‚’å®Ÿè£…ã—ãŸ
- [ ] 204 No Contentã‚’ç†è§£ã—ãŸ
- [ ] 404 Not Foundã‚’ç†è§£ã—ãŸ
- [ ] 200 OKã¨204 No Contentã®é•ã„ã‚’ç†è§£ã—ãŸ
- [ ] response()->noContent()ã‚’ä½¿ã£ãŸ
