# Tutorial 7-2-5: 配列の操作

## 🎯 このセクションで学ぶこと

*   Tutorial 7-1-4で学んだ配列の基礎を、軽くおさらいする。
*   配列の要素を、追加、更新、削除する方法を学ぶ。
*   `print_r()`や`var_dump()`を使って、配列の中身を確認する方法を学ぶ。
*   便利な配列関数（`count()`、`in_array()`、`array_push()`など）を学ぶ。
*   `foreach`ループと配列を組み合わせて、複数のデータを効率的に処理する方法を再確認する。

---

## 導入

Tutorial 7-1-4で、配列の基礎（インデックス配列、連想配列、二次元配列）について学びました。このセクションでは、その知識を土台に、**配列をより実践的に操作する方法**を学んでいきます。

実際の開発では、配列に要素を追加したり、削除したり、特定の要素が存在するかを確認したりする場面が頻繁にあります。また、配列の要素数を数えたり、配列を結合したりする便利な関数も、PHPには多数用意されています。

このセクションでは、これらの実践的な操作方法をマスターしましょう。

---

## 詳細解説

### 📝 配列のおさらい

まずは、Tutorial 7-1-4で学んだ内容を、簡単におさらいしましょう。

| 種類 | 特徴 | 例 |
| :--- | :--- | :--- |
| **インデックス配列** | 番号（0, 1, 2...）で管理 | `$fruits = ['りんご', 'バナナ', 'みかん']` |
| **連想配列** | 名前（キー）で管理 | `$user = ['name' => '山田', 'age' => 30]` |
| **二次元配列** | 配列の中に配列 | `$products = [['name' => 'PC', 'price' => 80000], ...]` |

```php
// おさらい: 要素へのアクセス
$fruits = ['りんご', 'バナナ', 'みかん'];
echo $fruits[0]; // "りんご"（インデックスは0から始まる）

$user = ['name' => '山田', 'age' => 30];
echo $user['name']; // "山田"
```

> 💡 **ポイント**: 配列の基礎が不安な方は、Tutorial 7-1-4を復習してから進めましょう。

---

### ✏️ 要素の追加と更新

ここからが、このセクションの本題です。配列に要素を追加・更新する方法を学びましょう。

#### 追加

**インデックス配列**の末尾に要素を追加するには、`[]` を使います。

```php
$fruits = ['りんご', 'バナナ'];

// 末尾に要素を追加
$fruits[] = 'みかん';
$fruits[] = 'ぶどう';

print_r($fruits);
// 出力: Array ( [0] => りんご [1] => バナナ [2] => みかん [3] => ぶどう )
```

**連想配列**に新しいキーと値のペアを追加するには、新しいキーを指定します。

```php
$user = [
    'name' => '山田 太郎',
];

// 新しいキーで要素を追加
$user['age'] = 30;
$user['email'] = 'yamada@example.com';

print_r($user);
// 出力: Array ( [name] => 山田 太郎 [age] => 30 [email] => yamada@example.com )
```

#### 更新

既存のキーを指定して値を代入すると、その要素が**上書き**されます。

```php
$fruits = ['りんご', 'バナナ', 'みかん'];

// キー1の要素を更新（バナナ → ぶどう）
$fruits[1] = 'ぶどう';

print_r($fruits);
// 出力: Array ( [0] => りんご [1] => ぶどう [2] => みかん )
```

```php
$user = ['name' => '山田', 'age' => 30];

// 年齢を更新
$user['age'] = 31;

echo $user['age']; // 31
```

---

### 🗑️ 要素の削除

特定の要素を削除するには、`unset()`関数を使います。

```php
$fruits = ['りんご', 'バナナ', 'みかん'];

// キー1の要素（バナナ）を削除
unset($fruits[1]);

print_r($fruits);
// 出力: Array ( [0] => りんご [2] => みかん )
```

> **⚠️ 注意: インデックスは詰められない**
> `unset()`で要素を削除しても、インデックスは自動的に詰められません（歯抜けの状態になる）。上の例では、キー1が削除され、キー0とキー2だけが残っています。

インデックスを詰め直したい場合は、`array_values()`関数を使います。

```php
$fruits = ['りんご', 'バナナ', 'みかん'];
unset($fruits[1]);

// インデックスを詰め直す
$fruits = array_values($fruits);

print_r($fruits);
// 出力: Array ( [0] => りんご [1] => みかん )
```

---

### 🔍 配列の中身を確認する

配列の中身を確認するための関数を紹介します。デバッグ時に非常に便利です。

#### `print_r()` - 見やすく表示

```php
$user = ['name' => '山田', 'age' => 30];
print_r($user);
// 出力: Array ( [name] => 山田 [age] => 30 )
```

#### `var_dump()` - 型情報も表示

```php
$user = ['name' => '山田', 'age' => 30];
var_dump($user);
// 出力:
// array(2) {
//   ["name"]=> string(6) "山田"
//   ["age"]=> int(30)
// }
```

| 関数 | 特徴 | 使いどころ |
| :--- | :--- | :--- |
| `print_r()` | 見やすい形式で表示 | 配列の構造をサッと確認したいとき |
| `var_dump()` | 型情報も含めて詳細に表示 | 型のチェックが必要なとき |

---

### 🛠️ 便利な配列関数

PHPには、配列を操作するための便利な関数が多数用意されています。よく使うものを紹介します。

#### `count()` - 要素数を数える

```php
$fruits = ['りんご', 'バナナ', 'みかん'];
echo count($fruits); // 3
```

#### `in_array()` - 値が存在するか確認

```php
$fruits = ['りんご', 'バナナ', 'みかん'];

if (in_array('バナナ', $fruits)) {
    echo 'バナナがあります！';
}
// 出力: バナナがあります！
```

#### `array_push()` - 末尾に要素を追加

```php
$fruits = ['りんご', 'バナナ'];
array_push($fruits, 'みかん', 'ぶどう');

print_r($fruits);
// 出力: Array ( [0] => りんご [1] => バナナ [2] => みかん [3] => ぶどう )
```

> 💡 **ポイント**: `$fruits[] = 'みかん'`と`array_push()`は似ていますが、`array_push()`は一度に複数の要素を追加できます。

#### `array_merge()` - 配列を結合

```php
$fruits1 = ['りんご', 'バナナ'];
$fruits2 = ['みかん', 'ぶどう'];

$all_fruits = array_merge($fruits1, $fruits2);

print_r($all_fruits);
// 出力: Array ( [0] => りんご [1] => バナナ [2] => みかん [3] => ぶどう )
```

#### `array_key_exists()` - キーが存在するか確認

```php
$user = ['name' => '山田', 'age' => 30];

if (array_key_exists('email', $user)) {
    echo 'メールアドレスがあります';
} else {
    echo 'メールアドレスがありません';
}
// 出力: メールアドレスがありません
```

#### 配列関数まとめ

| 関数 | 説明 | 例 |
| :--- | :--- | :--- |
| `count($array)` | 要素数を返す | `count(['a', 'b', 'c'])` → `3` |
| `in_array($value, $array)` | 値が存在するか | `in_array('a', ['a', 'b'])` → `true` |
| `array_push($array, $value)` | 末尾に追加 | 複数要素を一度に追加可能 |
| `array_merge($arr1, $arr2)` | 配列を結合 | 2つの配列を1つに |
| `array_key_exists($key, $array)` | キーが存在するか | 連想配列で便利 |
| `array_values($array)` | インデックスを詰め直す | `unset()`後に使用 |

---

### 🔄 配列と`foreach`ループ

Tutorial 7-2-4で学んだ`foreach`ループは、配列を扱う上で最強のパートナーです。ここでは、より実践的な使い方を見ていきましょう。

#### 二次元配列のループ処理

データベースから取得したデータは、多くの場合、二次元配列の形式になっています。

```php
$users = [
    ['name' => '山田', 'age' => 30],
    ['name' => '佐藤', 'age' => 25],
    ['name' => '鈴木', 'age' => 35],
];

// ユーザー情報の配列をループ処理
foreach ($users as $user) {
    echo '名前: ' . $user['name'] . '、年齢: ' . $user['age'] . '歳<br>';
}
// 出力:
// 名前: 山田、年齢: 30歳
// 名前: 佐藤、年齢: 25歳
// 名前: 鈴木、年齢: 35歳
```

**コードリーディング**：

| コード | 説明 |
| :--- | :--- |
| `foreach ($users as $user)` | `$users`配列から1つずつ要素を取り出し、`$user`に代入 |
| `$user['name']` | 取り出した連想配列から、キー`name`の値を取得 |

#### キーと値を同時に取得

連想配列をループする際、キーも同時に取得したい場合は、`$key => $value`の形式を使います。

```php
$scores = [
    '国語' => 80,
    '数学' => 95,
    '英語' => 72,
];

foreach ($scores as $subject => $score) {
    echo $subject . ': ' . $score . '点<br>';
}
// 出力:
// 国語: 80点
// 数学: 95点
// 英語: 72点
```

---

## ✨ まとめ

このセクションでは、配列の実践的な操作方法を学びました。

*   **追加**: `$array[] = 値` または `$array['キー'] = 値`
*   **更新**: 既存のキーに新しい値を代入
*   **削除**: `unset($array[キー])`（インデックスは詰められない）
*   **確認**: `print_r()`で見やすく、`var_dump()`で詳細に
*   **便利な関数**: `count()`, `in_array()`, `array_push()`, `array_merge()`, `array_key_exists()`
*   **`foreach`との連携**: 二次元配列のループ処理、キーと値の同時取得

配列と`foreach`ループの組み合わせは、Laravelでの開発において頻繁に使う必須のパターンです。特に、データベースから取得したデータを表示する際に、この知識が活きてきます。

---
