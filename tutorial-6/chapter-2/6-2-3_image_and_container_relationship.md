# Tutorial 6-2-3: イメージとコンテナの関係

## 🎯 このセクションで学ぶこと

*   Dockerの「イメージ」と「コンテナ」の、正確な関係性を、比喩を使って、明確に理解する。
*   Dockerfileという、コンテナの「設計図」の、基本的な役割と構造を学ぶ。
*   Docker Hubという、イメージを共有するための、公開レジストリの役割を理解する。

---

## 導入

前のセクションで、`docker run nginx` のように、コマンドの最後に、`nginx` という「イメージ名」を指定しました。そして、その結果として、「コンテナ」が作成され、実行されました。

この、「**イメージ (Image)**」と「**コンテナ (Container)**」の関係は、Dockerを理解する上で、非常に重要でありながら、初学者が、最も混乱しやすいポイントでもあります。

この関係性を、プログラミングの世界で、最も有名な概念の一つである、**オブジェクト指向プログラミング**の、「**クラス**」と「**インスタンス**」の関係に、例えてみましょう。

*   **イメージ (Image)** は、「**クラス (Class)**」のようなものです。クラスは、オブジェクトの、設計図や、テンプレート（雛形）であり、それ自体は、実体を持ちません。例えば、「`Car`」というクラスは、「車とは、タイヤが4つあり、ハンドルがあり、アクセルとブレーキを持つものである」という、**定義**に過ぎません。

*   **コンテナ (Container)** は、「**インスタンス (Instance)**」のようなものです。インスタンスは、クラスという設計図に基づいて作成された、**具体的な実体**です。例えば、「`Car`」クラスから作られた、「私の赤いフェラーリ」や、「あなたの黒いプリウス」が、インスタンスにあたります。これらは、全て「`Car`」クラスの、インスタンスですが、それぞれが、独立した、具体的な存在です。

同様に、`nginx`という**イメージ（クラス）**から、`my-nginx`という**コンテナ（インスタンス）**や、`another-nginx`という、別のコンテナ（インスタンス）を、いくつでも、作成することができるのです。そして、それぞれのコンテナは、互いに、独立して動作します。

---

## 詳細解説

### 📜 イメージの設計図: Dockerfile

では、`nginx`や`ubuntu`といった、Dockerイメージは、一体、どのようにして作られるのでしょうか？その答えが、**`Dockerfile`** です。

`Dockerfile`は、コンテナの、「**設計図**」や、「**レシピ**」にあたる、テキストファイルです。このファイルに、「どのようなOSをベースにして、どのようなソフトウェアをインストールし、どのような設定を行い、最終的に、どのコマンドを実行するのか」といった、一連の指示を、記述していきます。

以下は、非常にシンプルな、Webサーバーの`Dockerfile`の例です。

```dockerfile
# ベースとなるイメージを指定
FROM ubuntu:22.04

# 必要なソフトウェアをインストール
RUN apt-get update && apt-get install -y nginx

# HTMLファイルをコンテナにコピー
COPY index.html /var/www/html/

# 80番ポートを開放
EXPOSE 80

# コンテナ起動時に実行されるコマンド
CMD ["nginx", "-g", "daemon off;"]
```

この`Dockerfile`を、`docker build`というコマンドで、ビルド（構築）することで、あなただけの、カスタムDockerイメージが、作成されます。

*   `FROM`: ベースとなる、親イメージを指定します。多くの場合、`ubuntu`や`alpine`といった、OSの公式イメージが使われます。
*   `RUN`: シェルコマンドを実行します。ソフトウェアのインストールなどに使います。
*   `COPY`: ホストOSのファイルを、コンテナ内にコピーします。
*   `EXPOSE`: コンテナが、外部に公開するポート番号を指定します。
*   `CMD`: コンテナが起動した時に、デフォルトで実行されるコマンドを指定します。

このカリキュラムでは、`Dockerfile`を、ゼロから書くことは、あまりありませんが、この基本的な構造を理解しておくことは、Dockerを、より深く理解する上で、非常に重要です。

### ☁️ イメージの保管庫: Docker Hub

`docker build`で作成したイメージや、`docker run`の際に、Dockerが、どこからかダウンロードしてきたイメージは、どこに保管されているのでしょうか？

その、中心的な場所が、**Docker Hub** です。

*   **Docker Hubとは？**: Docker社が、公式に運営している、**Dockerイメージのための、公開レジストリ（保管庫）**です。GitHubが、ソースコードの保管・共有サービスであるように、Docker Hubは、Dockerイメージの、保管・共有サービスです。
*   **公式イメージ**: `ubuntu`, `nginx`, `php`, `mysql`など、多くの、主要なソフトウェアの、公式イメージが、Docker Hubで公開されており、誰でも、無料で、利用することができます。
*   **パブリック/プライベートリポジトリ**: 自分で作成したイメージを、Docker Hubにアップロード（`push`）して、世界中に公開したり、プライベートなリポジトリとして、チーム内だけで共有したりすることもできます。

`docker run nginx` とコマンドを打った時、Dockerエンジンは、以下の順序で、イメージを探します。

1.  **ローカル**: まず、自分のPC（ローカル）に、`nginx`という名前のイメージが存在するかどうかを確認します。
2.  **Docker Hub**: ローカルに存在しない場合、Docker Hubにアクセスし、`nginx`という名前の、公式イメージを探して、ダウンロード（`pull`）してきます。

この仕組みのおかげで、私たちは、世界中の開発者が作成した、高品質なイメージを、コマンド一つで、簡単に利用することができるのです。

---

## ✨ まとめ

このセクションでは、Dockerの、中核をなす、「イメージ」と「コンテナ」の関係性について、詳しく学びました。

*   **イメージとコンテナの関係**: イメージは「**クラス（設計図）**」であり、コンテナは、そのイメージから作成された「**インスタンス（実体）**」である。一つのイメージから、複数の、独立したコンテナを作成できる。
*   **Dockerfile**: コンテナの構成を定義する、「**設計図**」となるテキストファイル。`docker build`コマンドで、Dockerfileから、カスタムイメージを作成する。
*   **Docker Hub**: Dockerイメージを、保管・共有するための、**公開レジストリ**。`docker run`コマンドは、ローカルにイメージがない場合、Docker Hubから、自動的にダウンロードしてくる。

この、「イメージ」と「コンテナ」の、明確な分離が、Dockerの、高い再利用性と、移植性を、実現しているのです。

次のセクションでは、複数のコンテナを、連携させて、より、実践的なアプリケーション環境を構築するためのツール、「Docker Compose」について学びます。

---
