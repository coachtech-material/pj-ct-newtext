# Tutorial 7-4-1: フォームデータの受け取り

## 🎯 このセクションで学ぶこと

*   HTMLフォームと、PHPが、どのように連携するのかを理解する。
*   `$_GET`と`$_POST`という、スーパーグローバル変数の違いと、役割を理解する。
*   `$_POST`を使って、フォームから送信されたデータを、PHPで受け取る方法を学ぶ。
*   セキュリティの基本である、`htmlspecialchars`関数の、重要性を理解する。

---

## 導入

Webアプリケーションの、最も、基本的な機能の一つが、「**ユーザーからの入力を受け取り、それに応じて、何かを処理する**」ことです。例えば、ログイン画面、検索ボックス、お問い合わせフォームなど、あらゆる場面で、ユーザーからのデータ入力を、受け付けています。

この、ユーザーからの入力を、受け取るための、窓口となるのが、**HTMLの`<form>`タグ**です。そして、そのフォームから、送信されたデータを、サーバーサイドで、受け取るのが、PHPの役割です。

このセクションでは、HTMLのフォームから、送信されたデータを、PHPで、どのように、受け取るのか、その基本的な仕組みと、実践的なコードについて、学んでいきます。

---

## 詳細解説

### 📜 HTMLフォームの基本

まず、データを送信する側である、HTMLフォームを、準備します。重要なのは、`action`属性と、`method`属性です。

```html
<!-- process.phpというファイルに、データを送信するフォーム -->
<form action="process.php" method="post">
    <!-- ユーザー名の入力欄 -->
    <label for="username">お名前:</label>
    <input type="text" id="username" name="username">

    <!-- 送信ボタン -->
    <button type="submit">送信</button>
</form>
```

*   **`action`属性**: フォームのデータを、**どこに（どのPHPファイルに）送信するか**を指定します。
*   **`method`属性**: データを、**どのように送信するか（送信方法）**を指定します。`post`と`get`の2種類があります。
*   **`name`属性**: 各入力欄（`<input>`など）に、**名前を付けます**。この`name`属性の値が、PHP側で、データを受け取る際の、キーになります。

### 📬 `$_GET` と `$_POST`

PHPには、フォームから送信されたデータを、受け取るために、**スーパーグローバル変数**という、特殊な変数が、あらかじめ、用意されています。フォームデータの受け取りには、主に、`$_GET`と`$_POST`の2つを使います。

| 送信方法 (`method`) | PHPの変数 | 特徴                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -|
| `get`                | `$_GET`   | *   データが、URLの末尾に、`?key=value&key2=value2` のように、付与されて、送信される。
*   URLに、データが表示されるため、パスワードなどの、機密情報には、絶対に使ってはいけない。
*   ブックマーク可能な、検索結果ページなどで、利用される。
*   送信できる、データ量に、制限がある。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -|
| `post`               | `$_POST`  | *   データが、HTTPリクエストの、ボディ部分に、格納されて、送信される。
*   URLに、データが表示されないため、ログイン情報や、個人情報など、**機密性の高いデータ**の送信に、使われる。
*   送信できる、データ量に、実質的な、制限はない。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -|

**原則として、ユーザーに、何かを入力させるフォームでは、`method="post"` を使う**、と覚えておきましょう。

### 🤝 `$_POST`を使ったデータ受け取り

それでは、先ほどのHTMLフォームから、送信されたデータを、`process.php`で、受け取ってみましょう。

`$_POST`は、**連想配列**になっており、キーは、HTMLフォームの`name`属性、値は、ユーザーが入力した値です。

```php
// process.php

// $_POSTの中身を確認する（デバッグ用）
var_dump($_POST);
// array(1) {
//   ["username"]=>
//   string(9) "山田 太郎"
// }

// "username"というキーで、データを取り出す
$username = $_POST["username"];

echo "こんにちは、" . $username . "さん！";
// こんにちは、山田 太郎さん！
```

### 🛡️ セキュリティ: `htmlspecialchars`

ユーザーからの入力を、そのまま、画面に表示するのは、**非常に危険**です。悪意のあるユーザーが、フォームに、HTMLタグや、JavaScriptのコードを、入力した場合、それが、そのまま、実行されてしまう可能性があるからです。これを、**クロスサイトスクリプティング (XSS)** と呼びます。

この脆弱性を、防ぐために、PHPには、`htmlspecialchars`という関数が、用意されています。

`htmlspecialchars`は、`<`、`>`、`&`、`"` といった、HTMLにおいて、特別な意味を持つ文字を、無害な、別の文字列（HTMLエンティティ）に、変換してくれます。

**ユーザーからの入力値を、画面に出力する際は、必ず、`htmlspecialchars`を通す**、ということを、徹底してください。

```php
// process.php (安全なバージョン)

// データを受け取る
$username = $_POST["username"];

// htmlspecialchars()で、エスケープ処理を行う
$safe_username = htmlspecialchars($username, ENT_QUOTES, 'UTF-8');

echo "こんにちは、" . $safe_username . "さん！";

// もし、ユーザーが <script>alert('XSS');</script> と入力しても、
// 画面には、単なる文字列として表示され、スクリプトは実行されない。
```

*   `ENT_QUOTES`: シングルクォートと、ダブルクォートの両方を、変換する、というオプションです。
*   `'UTF-8'`: 文字コードを指定します。

Laravelでは、Bladeテンプレートエンジンが、自動的に、このエスケープ処理を行ってくれるため、開発者が、意識することは、少ないですが、その裏側で、このような、基本的な、セキュリティ対策が、行われていることを、理解しておくことは、非常に重要です。

---

## ✨ まとめ

このセクションでは、Webアプリケーションの、基本である、フォームデータの、受け取り方法について学びました。

*   **HTMLフォーム**: `action`で送信先、`method`で送信方法を指定する。入力欄には`name`属性が必須。
*   **送信方法**: 原則として、`method="post"` を使う。
*   **`$_POST`**: `post`で送信されたデータを、受け取るための、スーパーグローバル変数（連想配列）。
*   **`htmlspecialchars`**: XSS攻撃を防ぐため、ユーザーからの入力を、画面に出力する際には、**必ず**、この関数で、エスケープ処理を行う。

ユーザーからの入力を、受け取れるようになると、アプリケーションは、一気に、インタラクティブになります。次のセクションでは、サーバー上に、データを保存するための、ファイルの読み書きについて、学んでいきます。

---

## 📝 学習のポイント

- [ ] `method`属性の、`get`と`post`の違いを、説明できる。
- [ ] `$_POST`を使って、フォームから送信された、特定のデータを、取り出すことができる。
- [ ] `htmlspecialchars`が、なぜ、必要なのかを、説明できる。
- [ ] 簡単な、入力フォームと、そのデータを受け取って、表示する、PHPスクリプトを、作成できる。
