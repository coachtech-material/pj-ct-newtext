# Tutorial 7-2-2: 引数の型宣言と戻り値の型宣言

## 🎯 このセクションで学ぶこと

*   型宣言とは何か、その重要性（バグの早期発見、可読性の向上）を理解する。
*   関数の引数に、型を宣言する方法を学ぶ。
*   関数の戻り値に、型を宣言する方法を学ぶ。
*   PHP 7以降の、モダンなPHP開発において、型宣言が、なぜ、標準的な作法となっているのかを理解する。

---

## 導入

前のセクションで、関数と、その引数、戻り値について学びました。しかし、私たちが書いた `add` 関数には、実は、潜在的な問題が、潜んでいます。

```php
function add($a, $b)
{
    return $a + $b;
}

// 意図した使い方
echo add(3, 5); // 8

// 意図しない使い方
echo add(3, "5");      // 8 (PHPがよしなに解釈してくれる)
echo add(3, "りんご"); // エラー (Warning: A non-numeric value encountered)
```

PHPは、動的型付け言語であるため、`add`関数に、数値ではなく、文字列を渡しても、エラーにはならず、PHPが、よしなに、型を変換（型ジャグリング）して、計算しようと試みます。`"5"`のような、数値に見える文字列なら、うまくいきますが、`"りんご"`のような、全く、数値でないものを渡されると、エラー（Warning）が発生してしまいます。

このような、意図しない型のデータが、関数に渡されることを防ぎ、プログラムの、安全性と、信頼性を、劇的に向上させる仕組みが、**型宣言 (Type Declarations)** です。

---

## 詳細解説

### 🛡️ 型宣言とは？

型宣言とは、**関数の引数や、戻り値が、どのようなデータ型であるべきかを、明示的に、宣言する仕組み**です。これにより、宣言された型と、異なる型のデータが、渡されたり、返されたりした場合に、PHPが、即座に、エラー（TypeError）を、発生させてくれます。

型宣言には、2つの大きなメリットがあります。

1.  **バグの早期発見**: 意図しない型のデータが、紛れ込むことによる、予期せぬバグを、実行前に、防ぐことができます。これにより、デバッグが、容易になり、プログラムの、堅牢性が、向上します。

2.  **可読性の向上**: 関数のシグネチャ（定義）を見るだけで、その関数が、どのようなデータを、必要とし、どのようなデータを、返すのかが、一目瞭然になります。これは、コードの、自己文書化に繋がり、未来の自分や、他の開発者が、コードを理解するのを、助けます。

Laravelを含む、現代のPHP開発では、**コードの品質と、保守性を高めるために、型宣言を、積極的に、利用することが、標準的な作法**となっています。

### ✍️ 引数の型宣言

関数の引数に、型を宣言するには、引数名の前に、データ型を記述します。

```php
// 引数 $a と $b は、必ず整数(int)でなければならない、と宣言
function add(int $a, int $b)
{
    return $a + $b;
}

// OK: 整数を渡している
echo add(3, 5); // 8

// NG: 文字列を渡そうとすると、TypeErrorが発生し、実行が停止する
// echo add(3, "5"); // Fatal error: Uncaught TypeError: ...
```

宣言できる型は、`int`, `string`, `bool`, `array`, `float` などの、基本的な型に加え、後で学ぶ、クラス名や、インターフェース名も、指定することができます。

### 🚚 戻り値の型宣言

関数の戻り値に、型を宣言するには、引数の丸括弧 `()` の後に、コロン（`:`）と、データ型を記述します。

```php
// 戻り値は、必ず整数(int)でなければならない、と宣言
function add(int $a, int $b): int
{
    return $a + $b;
}

// OK: 整数を返す
$result = add(3, 5);
echo $result; // 8

// 戻り値の型が違う関数
function add_and_format(int $a, int $b): int
{
    $sum = $a + $b;
    // NG: 文字列を返そうとすると、TypeErrorが発生する
    // return "合計は: " . $sum; // Fatal error: Uncaught TypeError: ...
}
```

戻り値がない（何も返さない）ことを、明示したい場合は、`void`という、特殊な型を宣言します。`echo`などで、画面に出力するだけの関数は、何も値を返さないため、`void`が、よく使われます。

```php
function sayHello(string $name): void
{
    echo "こんにちは、" . $name . "さん！";
    // return は書かない
}

sayHello("鈴木");
```

### 厳密な型チェック (Strict Types)

デフォルトでは、PHPは、可能な場合、型を、自動的に変換しようと試みます。例えば、`int`を期待している引数に、文字列の`"5"`を渡すと、PHPは、それを、整数の`5`に、自動的に変換してくれます。これを、**弱い型付けモード (Weak typing mode)** と呼びます。

しかし、より、厳密に、型をチェックし、暗黙の型変換を、一切、許可しないようにすることもできます。そのためには、PHPファイルの、一番上に、以下の宣言を記述します。

```php
<?php
declare(strict_types=1);

function add(int $a, int $b): int
{
    return $a + $b;
}

// OK: 整数を渡している
echo add(3, 5); // 8

// NG: 厳密モードでは、文字列の"5"は、整数とは見なされず、TypeErrorが発生する
// echo add(3, "5"); // Fatal error: Uncaught TypeError: ...
```

この、**厳密な型チェックモード (Strict typing mode)** を、有効にすることで、予期せぬ、型の不一致を、より、確実に、防ぐことができ、コードの、信頼性が、さらに向上します。Laravel 10以降で作成される、アプリケーションのファイルには、デフォルトで、この `declare(strict_types=1);` が、記述されており、**厳密モードで開発することが、現代の、標準的なスタイル**です。

---

## ✨ まとめ

このセクションでは、関数の、安全性と、信頼性を、高めるための、型宣言について学びました。

*   **型宣言**: 関数の引数や、戻り値の、データ型を、明示的に、宣言する仕組み。
*   **メリット**: **バグの早期発見**と、**可読性の向上**に、大きく貢献する。
*   **引数の型宣言**: `function add(int $a, string $b)` のように、引数名の前に、型を記述する。
*   **戻り値の型宣言**: `function add(): int` のように、`()` の後に、`: 型` を記述する。何も返さない場合は、`: void` を使う。
*   **厳密モード**: `declare(strict_types=1);` を、ファイルの先頭に記述することで、暗黙の型変換を、禁止し、より、厳密な、型チェックを、行うことができる。

型宣言は、少し、窮屈に、感じるかもしれませんが、大規模なアプリケーションを、安全に、開発・保守していく上では、不可欠な機能です。今のうちから、全ての関数に、型宣言を付ける癖を、つけていきましょう。

---
