# Tutorial 7-1-2: PHPの実行環境

## 🎯 このセクションで学ぶこと

*   PHPのコードが、どのようにして実行され、ブラウザに表示されるのか、その一連の流れを理解する。
*   Tutorial 6で構築した`php-practice`環境を使って、PHPを動かしてみる。

---

## 導入

前のセクションで、PHPがサーバーサイドで実行される言語であることを学びました。では、具体的に、「サーバーサイドで実行される」とは、どういうことなのでしょうか？

HTMLファイルであれば、PC上のファイルを、直接ブラウザで開けば、その内容が表示されました。しかし、PHPファイルは、同じように、直接ブラウザで開いても、`<?php ... ?>` というコードが、そのまま表示されてしまうだけで、意図した通りには動作しません。

PHPのコードを実行するには、**Webサーバー**と**PHP実行環境**という、2つの要素が必要です。このセクションでは、Tutorial 6で構築した環境を使って、PHPの動作を確認してみましょう。

---

## 詳細解説

### 🎭 PHPが実行されるまでの流れ

ユーザーが、ブラウザで、PHPのページ（例: `index.php`）にアクセスしてから、その結果が、画面に表示されるまで、以下のような流れで処理が行われます。

1.  **リクエスト**: ユーザーのブラウザが、Webサーバーに対して、「`index.php`のページをください」という、リクエストを送信します。

2.  **PHPの実行**: Webサーバーは、アクセスされたファイルが `.php` であることを認識し、PHP実行環境に処理を依頼します。PHP実行環境は、`index.php`ファイルの内容を、上から順に解釈・実行します。

3.  **HTMLの生成**: PHPコードの実行結果（例: `echo`で出力された文字列など）が、HTMLに変換されます。

4.  **レスポンス**: 生成されたHTMLが、ユーザーのブラウザに送信されます。

5.  **表示**: ブラウザは、受け取ったHTMLを解釈し、画面に表示します。ブラウザから見れば、それが、元々、PHPファイルだったのか、静的なHTMLファイルだったのかは、区別がつきません。

```
[ブラウザ] → リクエスト → [Webサーバー] → [PHP実行環境] → HTMLを生成 → [ブラウザ]
```

### 🐳 php-practice環境の確認

Tutorial 6のハンズオンで、`php-practice`ディレクトリにDocker環境を構築しました。この環境には、以下の2つのコンテナが含まれています。

| コンテナ | 役割 |
|---------|------|
| **nginx** | Webサーバー。ブラウザからのリクエストを受け付けます |
| **php** | PHP実行環境。PHPコードを実行してHTMLを生成します |

**ディレクトリ構造の確認:**

```
~/php-practice/
├── docker/
│   └── nginx/
│       └── default.conf    # Nginxの設定ファイル
├── src/
│   └── index.php           # PHPファイルを置くディレクトリ
└── docker-compose.yml      # Dockerの設定ファイル
```

> 💡 **ポイント**: Tutorial 7のハンズオン演習では、すべて`src/`ディレクトリ内にPHPファイルを作成していきます。

### ✍️ PHPコードを書いて動かしてみよう

それでは、実際に、この環境で、PHPのコードを書いて、動かしてみましょう。

#### Step 1: 環境の起動

まず、`php-practice`ディレクトリに移動し、Docker環境を起動します。

```bash
cd ~/php-practice
docker-compose up -d
```

起動が完了したら、`docker-compose ps`コマンドで、コンテナが正常に起動していることを確認してください。

#### Step 2: PHPファイルの編集

`src/index.php`ファイルを、以下の内容に編集してください。

```php
<?php
// src/index.php
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>はじめてのPHP</title>
</head>
<body>
    <h1>PHPの世界へようこそ！</h1>
    <p>PHPを使って、動的なコンテンツを表示してみましょう。</p>
    <p>1 + 1 は、<?php echo 1 + 1; ?> です。</p>
    <p>現在の日時は、<?php echo date("Y年m月d日 H時i分s秒"); ?> です。</p>
</body>
</html>
```

#### Step 3: ブラウザで確認

Webブラウザで、`http://localhost:8000/index.php` にアクセスします。

画面に、「1 + 1 は、2 です。」や、現在の日時が、正しく表示されていれば、成功です！ブラウザの「ページのソースを表示」機能で、ソースコードを確認してみてください。`<?php ... ?>`の部分は、完全に消え、その実行結果である「2」や、日時の文字列に、置き換わっていることが、確認できるはずです。

> 💡 **環境の停止**: 作業が終わったら、`docker-compose down`コマンドで環境を停止できます。次回作業するときは、再び`docker-compose up -d`で起動してください。



---

## ✨ まとめ

このセクションでは、PHPのコードが、サーバーの裏側で、どのように実行されるのか、その流れを学びました。

*   **PHPの実行フロー**: `ブラウザ → Webサーバー → PHP実行環境 → HTMLを生成 → ブラウザ` という流れで、処理が進む。
*   **php-practice環境**: Tutorial 6で構築したDocker環境（nginx + php）を使って、PHPを実行できる。
*   **動作確認**: `src`ディレクトリに、PHPファイルを作成し、`localhost:8000`にアクセスすることで、PHPが、正常に動作していることを確認した。

次のセクションから、いよいよ、PHPの、具体的な文法について、学んでいきましょう。

---
