# 9-7-1 Laravel Fortifyとは

## 🎯 このセクションで学ぶこと

*   Laravel Fortifyが何であるか、その役割を理解する。
*   セッションベース認証の仕組みを理解する。
*   なぜFortifyを使うのか、認証機能を自作する場合との違いを説明できるようになる。

---

## 導入：Webアプリケーションにおける認証の必要性

これまでのセクションで、データベース操作、バリデーション、リレーションシップなど、Laravelの基本的な機能を学んできました。しかし、実際のWebアプリケーションでは、**「誰がアクセスしているのか」を識別する仕組み**が必要です。これが**認証（Authentication）**です。

例えば、ブログシステムを作る場合、以下のような機能が必要になります：

*   ユーザー登録（新しいユーザーがアカウントを作成）
*   ログイン（既存のユーザーが自分のアカウントにアクセス）
*   ログアウト（セッションを終了）
*   認証済みユーザーのみがアクセスできるページ（マイページ、投稿作成など）

これらの機能を一から実装するのは大変です。そこで、Laravelでは**Laravel Fortify**という公式パッケージを使って、簡単に認証機能を実装できます。

---

## 詳細解説

### 🔐 Laravel Fortifyとは

**Laravel Fortify**は、Laravelの公式認証パッケージで、**フロントエンドに依存しない認証バックエンド**を提供します。

#### Fortifyの特徴

1. **セッションベース認証**：従来のWebアプリケーションで使われる、Cookieとセッションを使った認証方式
2. **フロントエンド非依存**：Bladeでも、Vue.jsでも、React.jsでも使える
3. **必要な機能が揃っている**：登録、ログイン、ログアウト、パスワードリセット、メール認証など
4. **カスタマイズ可能**：必要な機能だけを有効化できる

---

### 🔑 セッションベース認証の仕組み

Fortifyが採用している**セッションベース認証**の仕組みを理解しましょう。

```
1. ユーザーがログインフォームにメールアドレスとパスワードを入力
   ↓
2. サーバーがデータベースでユーザーを確認
   ↓
3. サーバーがセッションを作成し、セッションIDをCookieに保存
   ↓
4. 以降のリクエストでは、Cookieに含まれるセッションIDでユーザーを識別
   ↓
5. ログアウト時にセッションを削除
```

#### セッションとは

**セッション**とは、サーバー側で管理される「一時的な記憶領域」です。ログイン状態を保持するために使われます。

**身近な例で理解する**：
図書館で本を借りるとき、受付で「貸出カード」をもらいます。このカードを見せれば、「この人は会員だ」とわかります。セッションIDは、この「貸出カード」のようなものです。

#### Cookieとは

**Cookie**とは、ブラウザに保存される小さなデータです。セッションIDをCookieに保存することで、次回のリクエスト時にサーバーがユーザーを識別できます。

---

### 🆚 Fortifyを使う理由

認証機能を自作することもできますが、以下の理由からFortifyを使うことが推奨されます：

#### 1. セキュリティが確保されている

認証機能には、以下のようなセキュリティリスクがあります：

*   パスワードの平文保存（絶対にやってはいけない）
*   CSRF攻撃への脆弱性
*   セッション固定攻撃への脆弱性

Fortifyは、これらのセキュリティリスクに対する対策が組み込まれています。

#### 2. 実装時間の短縮

認証機能を一から実装すると、以下のような作業が必要です：

*   ユーザー登録フォームの作成
*   バリデーションの実装
*   パスワードのハッシュ化
*   セッション管理
*   ログイン・ログアウトの実装
*   パスワードリセット機能

Fortifyを使えば、これらの機能が**数行の設定**で実装できます。

#### 3. ベストプラクティスに従っている

Fortifyは、Laravelの公式パッケージなので、Laravelのベストプラクティスに従っています。自作すると、独自の実装になりがちですが、Fortifyを使えば、他の開発者にも理解しやすいコードになります。

---

### 📦 Fortifyが提供する機能

Fortifyは、以下の機能を提供します：

| 機能 | 説明 |
|------|------|
| **登録** | 新しいユーザーがアカウントを作成 |
| **ログイン** | メールアドレスとパスワードでログイン |
| **ログアウト** | セッションを終了 |
| **パスワードリセット** | パスワードを忘れた場合のリセット機能 |
| **メール認証** | 登録時にメールアドレスを確認 |
| **二要素認証** | セキュリティを強化するための追加認証 |

このセクションでは、基本的な**登録・ログイン・ログアウト**機能に焦点を当てます。

---

### 🔄 FortifyとLaravel Breezeの違い

Laravelには、Fortifyの他に**Laravel Breeze**という認証パッケージもあります。違いを理解しておきましょう。

| 項目 | Fortify | Breeze |
|------|---------|--------|
| **フロントエンド** | 含まれない（自分で作る） | 含まれる（Blade/Vue/React） |
| **カスタマイズ性** | 高い | 低い（テンプレートをカスタマイズ） |
| **学習目的** | 認証の仕組みを理解したい | すぐに使える認証が欲しい |

**Fortifyを選ぶ理由**：
このチュートリアルでは、**認証の仕組みを深く理解する**ことを目的としているため、フロントエンドを自分で作るFortifyを使います。

---

## 💡 TIP

### Fortifyはバックエンドのみ

Fortifyは、**認証のバックエンド処理**のみを提供します。ログインフォームやユーザー登録フォームなどのフロントエンドは、自分で作成する必要があります。

これは一見面倒に思えますが、**フロントエンドを自由に設計できる**というメリットがあります。

### 認証と認可の違い

*   **認証（Authentication）**：「誰がアクセスしているか」を確認すること（このセクションで学ぶ）
*   **認可（Authorization）**：「その人が何をできるか」を制御すること（次のチャプターで学ぶ）

例えば、ブログシステムでは：

*   **認証**：ログインして「山田太郎さん」だと確認する
*   **認可**：山田太郎さんは「自分の投稿のみ編集できる」と制御する

---

## ✨ まとめ

*   **Laravel Fortify**は、Laravelの公式認証パッケージで、セッションベース認証を提供する
*   **セッションベース認証**は、Cookieとセッションを使ってユーザーを識別する仕組み
*   Fortifyを使うことで、**セキュリティが確保され、実装時間が短縮される**
*   Fortifyは**バックエンドのみ**を提供し、フロントエンドは自分で作成する
*   **認証**は「誰か」を確認し、**認可**は「何ができるか」を制御する

---

## 📝 学習のポイント

- [ ] Laravel Fortifyが何であるか、説明できる
- [ ] セッションベース認証の仕組みを理解している
- [ ] Fortifyを使う理由を3つ以上挙げられる
- [ ] 認証と認可の違いを説明できる
- [ ] Fortifyが提供する機能を5つ以上挙げられる
