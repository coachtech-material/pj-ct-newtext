# Tutorial 9-1-3: MVCアーキテクチャを理解しよう

## 🎯 このセクションで学ぶこと

- Laravelが採用している「MVC」という設計パターンを理解する
- MVCの流れを、具体的にイメージできるようになる

> **📌 このセクションの目的**
> 
> このセクションは、Laravelの中心概念である**MVCのイメージを膨らませる**ことが目的です。
> コードの書き方を覚えることよりも、「全体の流れ」を直感的に理解することを優先してください。
> 実際のコードの書き方は、次のセクション以降で詳しく学びます。

---

## 🏛️ Laravelの「作法」を知ろう

Laravelを学ぶ前に、まず知っておいてほしいことがあります。

Laravelには、**「こういう風にコードを書いてね」という作法（ルール）**があります。

その作法の名前が、**MVC（エム・ブイ・シー）**です。

---

### なぜLaravelには作法があるの？

想像してみてください。

もし、何のルールもなく「好きにコードを書いていいよ」と言われたら、どうなるでしょう？

- 人によってファイルの置き場所がバラバラ
- 他の人が書いたコードが読めない
- 「この処理、どこに書けばいいの？」と迷子になる

これでは、チーム開発が成り立ちません。

そこでLaravelは、**「この種類の処理は、ここに書いてね」**というルールを決めています。

そのルールが、MVCです。

---

### 「設定より規約」という考え方

Laravelは**「設定より規約（Convention over Configuration）」**という考え方を採用しています。

これは、「細かい設定を自分で決めるのではなく、**フレームワークが決めたルール（規約）に従えば、自動的にうまくいく**」という考え方です。

例えば：

- `User`モデルを作ると、自動的に`users`テーブルと紐づく
- `UserController`を作ると、ユーザー関連の処理を担当するとわかる
- `resources/views/users/index.blade.php`に置けば、ユーザー一覧の画面だとわかる

**ルールに従うだけで、設定ファイルを書かなくても動く**。これがLaravelの便利さです。

逆に言えば、**ルールを知らないと「なぜ動くのかわからない」**ということでもあります。

だからこそ、まずはMVCというルールを理解することが大切なのです。

---

### MVCとは？

MVCとは、アプリケーションを**3つの役割**に分けて作る考え方です。

| 役割 | 名前 | やること |
|:---|:---|:---|
| **M** | Model（モデル） | データの取得・保存 |
| **V** | View（ビュー） | 画面の表示 |
| **C** | Controller（コントローラー） | 全体の司令塔 |

この3つが連携して、Webアプリケーションが動いています。

Laravelでコードを書くときは、この3つの役割に従ってファイルを作っていきます。

---

### でも、いまいちピンと来ない…

「Model」「View」「Controller」と言われても、正直、いまいちピンと来ないですよね。

そこで、**高級レストランの比喩**を使って、MVCの流れを理解していきましょう。

---

## 🍽️ MVCを「高級レストラン」で理解しよう

Laravelの仕組みは、高級レストランの一連の流れにそっくりです。

お客さん（ユーザー）が料理（ページ）を注文し、お店が料理（HTML）を出す。この流れを効率よく回すためのチーム編成が、MVCだと思ってください。

高級レストランでは、ホールと厨房で役割が明確に分かれています。さらに厨房の中でも、リーダーと実際に手を動かすシェフが分かれています。

---

### 高級レストランの登場人物

| 専門用語 | 高級レストランでの役割 | 説明 |
|:---|:---|:---|
| **ユーザー（ブラウザ）** | お客さん | 料理（ページ）を注文し、受け取る人 |
| **ルーティング** | ホールスタッフ | お客さんの注文を受け、メイン料理かデザートかを判断して、適切な厨房リーダーに伝える |
| **コントローラー** | 厨房リーダー（シェフリーダー / パティシエリーダー） | ホールからの注文を受け、部下のシェフに指示を出し、完成した料理をホールに渡す |
| **モデル** | シェフ（調理担当） | リーダーの指示を受け、冷蔵庫（DB）から食材を取り出し、実際に調理する |
| **ビュー** | 盛り付け担当 | シェフから受け取った料理をお皿に綺麗に盛り付け、お客様に出せる状態にする |

> **📌 ポイント**
> 
> **ルーティングは「ホールスタッフ」**です。
> 
> お客さんが「ステーキ」を注文すると、ホールスタッフは**シェフリーダー**に伝えます。
> お客さんが「ケーキ」を注文すると、ホールスタッフは**パティシエリーダー**に伝えます。
> 
> このように、**注文内容に応じて適切なリーダーに振り分ける**のがルーティングの役割です。
> 
> **コントローラーは「厨房リーダー」**です。
> リーダーは自分では調理しません。部下のシェフに指示を出し、完成した料理を受け取ってホールに渡す**司令塔**です。

---

## 🔄 注文から料理が届くまでの流れ

お客さんが「ユーザー一覧」を注文してから、画面が表示されるまでの流れを、高級レストランの比喩で追ってみましょう。

### 1. 注文（リクエスト）

お客さん（ブラウザ）がホールスタッフに「ユーザー一覧」を注文します。

```
お客さん: 「ユーザー一覧をお願いします」
```

---

### 2. 注文の振り分け（ルーティング → コントローラー）

ホールスタッフ（ルーティング）が、注文内容を確認し、適切な厨房リーダーに伝えます。

```
ホールスタッフ: 「ユーザー一覧の注文が入りました」
                → これはユーザー担当リーダー（UserController）の仕事だな
                → UserControllerに伝える！
```

> **📌 高級レストランでの例**
> 
> - 「ステーキ」の注文 → シェフリーダー（MealController）に伝える
> - 「ケーキ」の注文 → パティシエリーダー（DessertController）に伝える
> - 「ユーザー一覧」の注文 → ユーザー担当リーダー（UserController）に伝える
> 
> ホールスタッフが**注文内容を見て、適切なリーダーに振り分ける**のがルーティングの役割です。

---

### 3. 指示出し（コントローラー → モデル）

厨房リーダー（コントローラー）が、部下のシェフ（モデル）に指示を出します。

```
厨房リーダー: 「ユーザー一覧の注文だ。シェフ、ユーザーデータを全部取ってきてくれ」
```

リーダーは**司令塔**です。自分では調理（データ処理）も盛り付け（HTML生成）もしません。部下に指示を出すだけです。

---

### 4. 調理（モデル）

シェフ（モデル）が、冷蔵庫（データベース）から食材を取り出し、調理します。

```
シェフ: 「冷蔵庫からユーザー情報を全員分取ってきて、使いやすい形に整えました。リーダー、どうぞ」
```

シェフは、データベースから必要なデータを取り出し、**調理（データの整形）**をしてリーダーに渡します。

---

### 5. 盛り付け（ビュー）

厨房リーダーは、シェフから受け取った料理を盛り付け担当（ビュー）に渡します。

```
厨房リーダー: 「この料理を、お客様に出せる形にしてくれ」

盛り付け担当: 「おしゃれなリスト形式に並べて、お客様が見やすいページを作りました」
```

---

### 6. 提供（レスポンス）

盛り付けが完了した料理（HTML）を、厨房リーダーがホールスタッフに渡し、ホールスタッフがお客さんの元へ運びます。

```
厨房リーダー: 「できたぞ。ホールに渡してくれ」

ホールスタッフ: 「お待たせしました。ユーザー一覧でございます」
```

お客さん（ブラウザ）の画面に、ユーザー一覧が表示されます。

---

## 📊 処理の流れ（図解）

```
[お客さん（ブラウザ）]
   ↓ 「ユーザー一覧をお願いします」
[ホールスタッフ（ルーティング）]
   ↓ 「これはユーザー担当リーダーの仕事だな」→ UserControllerに伝える
[厨房リーダー（コントローラー）]
   ↓ 「シェフ、ユーザーデータを全部取ってきてくれ」
[シェフ（モデル）]
   ↓ 冷蔵庫（データベース）から食材を取り出して調理
[冷蔵庫（データベース）]
   ↑ ユーザーデータを渡す
[シェフ（モデル）]
   ↑ 調理したデータをリーダーに渡す
[厨房リーダー（コントローラー）]
   ↓ 「盛り付け担当、このデータで画面を作ってくれ」
[盛り付け担当（ビュー）]
   ↓ HTMLを生成
[ホールスタッフ（ルーティング）]
   ↓ お客さんに料理を運ぶ
[お客さん（ブラウザ）]
   ← ユーザー一覧が表示される
```

---

## 📁 それぞれのファイルはどこにある？

高級レストランの比喩で理解したところで、実際のファイルの場所を確認しましょう。

```
src/
├── app/
│   ├── Http/Controllers/  ← 厨房リーダー（コントローラー）
│   └── Models/            ← シェフ（モデル）
├── resources/
│   └── views/             ← 盛り付け担当（ビュー）
└── routes/
    └── web.php            ← ホールスタッフ（ルーティング）
```

| 高級レストランの役割 | 専門用語 | ファイルの場所 |
|:---|:---|:---|
| ホールスタッフ | **ルーティング** | `routes/web.php` |
| 厨房リーダー | **コントローラー** | `app/Http/Controllers/` |
| シェフ | **モデル** | `app/Models/` |
| 盛り付け担当 | **ビュー** | `resources/views/` |

---

## 💻 実際のコードで見てみよう

ここまで高級レストランの比喩で理解してきました。次は、実際のコードで同じ流れを確認してみましょう。

> **📌 注意**
> 
> ここでは**コードの雰囲気だけ**を掴んでください。
> 「このコードが何をやっているのか」をなんとなく理解できればOKです。
> 実際の書き方は、次のセクション以降で詳しく学びます。

---

### ルーティング（routes/web.php）＝ ホールスタッフ

```php
Route::get('/users', [UserController::class, 'index']);
Route::get('/meals', [MealController::class, 'index']);
Route::get('/desserts', [DessertController::class, 'index']);
```

**やっていること**: 「どの注文が来たら、どのリーダーに伝えるか」を定義しています。

- `/users`の注文 → UserController（ユーザー担当リーダー）に伝える
- `/meals`の注文 → MealController（シェフリーダー）に伝える
- `/desserts`の注文 → DessertController（パティシエリーダー）に伝える

高級レストランで言えば、**ホールスタッフが「この注文はこのリーダー」という対応を把握している**ようなものです。

---

### コントローラー（app/Http/Controllers/UserController.php）＝ 厨房リーダー

```php
public function index()
{
    $users = User::all();
    return view('users.index', compact('users'));
}
```

**やっていること**: 
1. シェフ（User）に「全てのユーザーを取得して」と指示
2. 取得したデータを盛り付け担当（users.index）に渡す

高級レストランで言えば、**厨房リーダーが部下のシェフに指示を出し、完成した料理を盛り付け担当に渡している**ところです。

---

### モデル（app/Models/User.php）＝ シェフ

```php
class User extends Model
{
    // User::all() で全てのユーザーを取得できる
}
```

**やっていること**: データベースの`users`テーブルと対応し、データの取得・調理を担当しています。

高級レストランで言えば、**シェフが冷蔵庫（データベース）から食材を取り出し、調理している**ところです。

> **📌 「設定より規約」の例**
> 
> `User`モデルを作ると、Laravelは自動的に`users`テーブルと紐づけます。
> 「Userモデルはusersテーブルを使う」という**規約**があるからです。
> 設定ファイルで「このモデルはこのテーブルを使う」と書く必要はありません。

---

### ビュー（resources/views/users/index.blade.php）＝ 盛り付け担当

```html
@foreach ($users as $user)
    <p>{{ $user->name }}</p>
@endforeach
```

**やっていること**: コントローラーから受け取ったユーザーデータを、HTMLとして整形しています。

高級レストランで言えば、**盛り付け担当が料理をお皿に綺麗に盛り付けている**ところです。

---

### 📊 処理の流れ（コード版）

```
[ブラウザ]
   ↓ GET /users
[ルーティング (routes/web.php)]
   ↓ UserController@index を呼び出す
[Controller (UserController.php)]
   ↓ User::all() を呼び出す
[Model (User.php)]
   ↓ SELECT * FROM users を実行
[データベース (MySQL)]
   ↑ ユーザーデータを返す
[Model (User.php)]
   ↑ データをオブジェクトに変換して返す
[Controller (UserController.php)]
   ↓ view('users.index', compact('users')) を呼び出す
[View (users/index.blade.php)]
   ↓ HTMLを生成
[ブラウザ]
   ← HTMLが表示される
```

---

## 💡 TIP: なぜ役割を分けるのか？

高級レストランで、ホールスタッフ・厨房リーダー・シェフ・盛り付け担当が別々にいるのはなぜでしょうか？

**全部一人でやると、お店が回らなくなるから**です。

同じように、Webアプリケーションでも、全ての処理を1つのファイルに書いてしまうと、コードが複雑になり、修正が困難になります。

役割を分けることで：

- **ルーティング**だけを変更すれば、URLの構成を変えられる
- **モデル**だけを変更すれば、データの取得方法を変えられる
- **ビュー**だけを変更すれば、画面のデザインを変えられる

それぞれの担当が独立しているので、**一箇所を変えても他に影響しない**のです。

---

## ✨ まとめ

このセクションでは、MVCの概念を高級レストランの比喩で学びました。

| 高級レストランの役割 | 専門用語 | やること |
|:---|:---|:---|
| ホールスタッフ | **ルーティング** | 注文を受け付け、担当のリーダーに伝える |
| 厨房リーダー | **コントローラー** | シェフに指示を出し、完成品をホールに渡す |
| シェフ | **モデル** | データベースからのデータ取得・調理 |
| 盛り付け担当 | **ビュー** | HTMLの生成 |

> **📌 ポイント**
> 
> このセクションでは、MVCの**概念と流れ**を理解することが目的でした。
> 「ルーティングはホールスタッフ」「コントローラーは厨房リーダー」「モデルはシェフ」というイメージを持っていれば大丈夫です。
> 
> また、Laravelは**「設定より規約」**という考え方を採用しています。
> ルールに従えば、設定ファイルを書かなくても自動的にうまくいきます。
> 
> 実際のコードの書き方は、次のセクション以降で詳しく学んでいきます。

次のセクションでは、MVCの最初のステップである「ルーティング」の実装方法を学びます。

---
