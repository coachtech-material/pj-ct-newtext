# Tutorial 9-1-3: MVCアーキテクチャを理解しよう

## 🎯 このセクションで学ぶこと

- Laravelが採用している「MVC」という設計パターンを理解する
- MVCの流れを、具体的にイメージできるようになる

> **📌 このセクションの目的**
> 
> このセクションは、Laravelの中心概念である**MVCのイメージを膨らませる**ことが目的です。
> コードの書き方を覚えることよりも、「全体の流れ」を直感的に理解することを優先してください。
> 実際のコードの書き方は、次のセクション以降で詳しく学びます。

---

## 🏛️ Laravelの「作法」を知ろう

Laravelを学ぶ前に、まず知っておいてほしいことがあります。

Laravelには、「こういう風にコードを書いてね」という作法（ルール）があります。

その作法の名前が、**MVC**です。

---

### なぜLaravelには作法があるの？

想像してみてください。

もし、何のルールもなく「好きにコードを書いていいよ」と言われたら、どうなるでしょう？

- 人によってファイルの置き場所がバラバラ
- 他の人が書いたコードが読めない
- 「この処理、どこに書けばいいの？」と迷子になる

これでは、チーム開発が成り立ちません。

そこでLaravelは、**「この種類の処理は、ここに書いてね」**というルールを決めています。

Laravelは**「設定より規約（Convention over Configuration）」**という考え方を採用しています。

これは、「細かい設定を自分で決めるのではなく、**フレームワークが決めたルール（規約）に従えば、自動的にうまくいく**」という考え方です。

**ルールに従うだけで、設定ファイルを書かなくても動く**。これがLaravelの便利さです。

逆に言えば、**ルールを知らないと「なぜ動くのかわからない」**ということでもあります。

だからこそ、まずはMVCというルールを理解することが大切なのです。

---

### MVCとは？

MVCとは、アプリケーションを**3つの役割**に分けて作る考え方です。

| 役割 | 名前 | やること |
|:---|:---|:---|
| **M** | Model（モデル） | データの取得・保存 |
| **V** | View（ビュー） | 画面の表示 |
| **C** | Controller（コントローラー） | 全体の司令塔 |

この3つが連携して、Webアプリケーションが動いています。

Laravelでコードを書くときは、この3つの役割に従ってファイルを作っていきます。

---

### でも、いまいちピンと来ない…

「Model」「View」「Controller」と言われても、正直、いまいちピンと来ないですよね。

そこで、**居酒屋の比喩**を使って、MVCの流れを理解していきましょう。

---

## 🍺 MVCを「居酒屋」で理解しよう

Laravelの仕組みは、居酒屋の営業にそっくりです。

お客さん（ユーザー）がタッチパネルで注文し、お店が料理やドリンク（HTML）を出す。この流れを効率よく回すためのチーム編成が、MVCです。

---

### 居酒屋の登場人物

居酒屋では、ドリンクとフードで担当が分かれています。Laravelも同じように、処理の種類ごとに担当が分かれています。

| 専門用語 | 居酒屋での役割 | 説明 |
|:---|:---|:---|
| **ユーザー（ブラウザ）** | お客さん | 料理やドリンク（ページ）を注文する人 |
| **ルーティング** | タッチパネル（注文端末） | お客さんの注文を受け付け、ドリンク担当かフード担当かを判断して通知する |
| **コントローラー** | ホールスタッフ | タッチパネルから通知を受け、キッチンに伝え、出来た料理を運ぶ |
| **モデル** | キッチンスタッフ | 冷蔵庫（DB）から食材を取り出し、調理してホールスタッフに渡す |
| **ビュー** | 盛り付け担当 | キッチンから受け取った料理をお皿に綺麗に盛り付け、お客様に出せる状態にする |

> **📌 ポイント**
> 
> **ルーティングは「タッチパネル（注文端末）」**です。
> 
> お客さんが「生ビール」を注文すると、タッチパネルは**ドリンク担当**に通知します。
> お客さんが「枝豆」を注文すると、タッチパネルは**フード担当**に通知します。
> 
> このように、**注文内容に応じて適切な担当者に振り分ける**のがルーティングの役割です。

---

## 🔄 注文から料理が届くまでの流れ

お客さんが「ユーザー一覧」を注文してから、画面が表示されるまでの流れを、居酒屋の比喩で追ってみましょう。

### 1. 注文（リクエスト）

お客さん（ブラウザ）がタッチパネルで「ユーザー一覧」を注文します。

```
お客さん: （タッチパネルで「ユーザー一覧」をタップ）
```

---

### 2. 注文の振り分け（ルーティング → コントローラー）

タッチパネル（ルーティング）が、注文内容を確認し、担当のホールスタッフに自動で通知します。

```
タッチパネル: 「ユーザー一覧の注文が入りました」
              → これはユーザー担当（UserController）の仕事だな
              → UserControllerに通知！
```

> **📌 居酒屋での例**
> 
> - 「生ビール」の注文 → ドリンク担当（DrinkController）に通知
> - 「枝豆」の注文 → フード担当（FoodController）に通知
> - 「ユーザー一覧」の注文 → ユーザー担当（UserController）に通知
> 
> タッチパネルが**注文内容を見て、適切な担当者に振り分ける**のがルーティングの役割です。

通知を受けたホールスタッフ（コントローラー）が対応を開始します。

```
ホールスタッフ: 「ユーザー一覧ですね。キッチン、ユーザーデータをお願いします！」
```

ホールスタッフは**司令塔**です。自分では料理（データ処理）も盛り付け（HTML生成）もしません。キッチンと盛り付け担当に指示を出すだけです。

---

### 3. 調理（モデル）

キッチンスタッフ（モデル）が、冷蔵庫（データベース）から食材を取り出し、調理します。

```
キッチン: 「冷蔵庫からユーザー情報を全員分取ってきて、使いやすい形に整えました。はい、どうぞ」
```

キッチンは、データベースから必要なデータを取り出し、**調理（データの整形）**をしてホールスタッフに渡します。

---

### 4. 盛り付け（ビュー）

ホールスタッフは、キッチンから受け取った料理を盛り付け担当（ビュー）に渡します。

```
ホールスタッフ: 「この料理を、お客様に出せる形にしてください」

盛り付け担当: 「おしゃれなリスト形式に並べて、お客様が見やすいページを作りました」
```

---

### 5. 提供（レスポンス）

出来上がった料理（HTML）を、ホールスタッフがお客さんの元へ運びます。

```
ホールスタッフ: 「お待たせしました。ユーザー一覧でございます」
```

お客さん（ブラウザ）の画面に、ユーザー一覧が表示されます。

---

## 📊 処理の流れ（図解）

```
[お客さん（ブラウザ）]
   ↓ タッチパネルで「ユーザー一覧」を注文
[タッチパネル（ルーティング）]
   ↓ 「これはユーザー担当の仕事だな」→ UserControllerに通知
[ホールスタッフ（コントローラー）]
   ↓ 「キッチン、ユーザーデータをください」
[キッチン（モデル）]
   ↓ 冷蔵庫（データベース）から食材を取り出して調理
[冷蔵庫（データベース）]
   ↑ ユーザーデータを渡す
[キッチン（モデル）]
   ↑ 調理したデータをホールスタッフに渡す
[ホールスタッフ（コントローラー）]
   ↓ 「盛り付け担当さん、このデータで画面を作ってください」
[盛り付け担当（ビュー）]
   ↓ HTMLを生成
[お客さん（ブラウザ）]
   ← ユーザー一覧が表示される
```

---

## 📁 それぞれのファイルはどこにある？

居酒屋の比喩で理解したところで、実際のファイルの場所を確認しましょう。

```
src/
├── app/
│   ├── Http/Controllers/  ← ホールスタッフ（コントローラー）
│   └── Models/            ← キッチン（モデル）
├── resources/
│   └── views/             ← 盛り付け担当（ビュー）
└── routes/
    └── web.php            ← タッチパネル（ルーティング）
```

| 居酒屋の役割 | 専門用語 | ファイルの場所 |
|:---|:---|:---|
| タッチパネル | **ルーティング** | `routes/web.php` |
| ホールスタッフ | **コントローラー** | `app/Http/Controllers/` |
| キッチン | **モデル** | `app/Models/` |
| 盛り付け担当 | **ビュー** | `resources/views/` |

---

## 💻 実際のコードで見てみよう

ここまで居酒屋の比喩で理解してきました。次は、実際のコードで同じ流れを確認してみましょう。

> **📌 注意**
> 
> ここでは**コードの雰囲気だけ**を掴んでください。
> 「このコードが何をやっているのか」をなんとなく理解できればOKです。
> 実際の書き方は、次のセクション以降で詳しく学びます。

---

### ルーティング（routes/web.php）＝ タッチパネル

```php
Route::get('/users', [UserController::class, 'index']);
Route::get('/drinks', [DrinkController::class, 'index']);
Route::get('/foods', [FoodController::class, 'index']);
```

**やっていること**: 「どの注文が来たら、どの担当者に通知するか」を定義しています。

- `/users`の注文 → UserControllerに通知
- `/drinks`の注文 → DrinkControllerに通知
- `/foods`の注文 → FoodControllerに通知

居酒屋で言えば、**タッチパネルに「この注文はこの担当者」という対応表が登録してある**ようなものです。

---

### コントローラー（app/Http/Controllers/UserController.php）＝ ホールスタッフ

```php
public function index()
{
    $users = User::all();
    return view('users.index', compact('users'));
}
```

**やっていること**: 
1. モデル（User）に「全てのユーザーを取得して」と依頼
2. 取得したデータをビュー（users.index）に渡す

居酒屋で言えば、**ホールスタッフがキッチンに料理を依頼し、受け取った料理を盛り付け担当に渡している**ところです。

---

### モデル（app/Models/User.php）＝ キッチン

```php
class User extends Model
{
    // User::all() で全てのユーザーを取得できる
}
```

**やっていること**: データベースの`users`テーブルと対応し、データの取得・調理を担当しています。

居酒屋で言えば、**キッチンが冷蔵庫（データベース）から食材を取り出し、調理している**ところです。

> **📌 「設定より規約」の例**
> 
> `User`モデルを作ると、Laravelは自動的に`users`テーブルと紐づけます。
> 「Userモデルはusersテーブルを使う」という**規約**があるからです。
> 設定ファイルで「このモデルはこのテーブルを使う」と書く必要はありません。

---

### ビュー（resources/views/users/index.blade.php）＝ 盛り付け担当

```html
@foreach ($users as $user)
    <p>{{ $user->name }}</p>
@endforeach
```

**やっていること**: コントローラーから受け取ったユーザーデータを、HTMLとして整形しています。

居酒屋で言えば、**盛り付け担当が料理をお皿に綺麗に盛り付けている**ところです。

---

### 📊 処理の流れ（コード版）

```
[ブラウザ]
   ↓ GET /users
[ルーティング (routes/web.php)]
   ↓ UserController@index を呼び出す
[Controller (UserController.php)]
   ↓ User::all() を呼び出す
[Model (User.php)]
   ↓ SELECT * FROM users を実行
[データベース (MySQL)]
   ↑ ユーザーデータを返す
[Model (User.php)]
   ↑ データをオブジェクトに変換して返す
[Controller (UserController.php)]
   ↓ view('users.index', compact('users')) を呼び出す
[View (users/index.blade.php)]
   ↓ HTMLを生成
[ブラウザ]
   ← HTMLが表示される
```

---

## 💡 TIP: なぜ役割を分けるのか？

居酒屋で、ホールスタッフ・キッチン・盛り付け担当が別々にいるのはなぜでしょうか？

**全部一人でやると、お店が回らなくなるから**です。

同じように、Webアプリケーションでも、全ての処理を1つのファイルに書いてしまうと、コードが複雑になり、修正が困難になります。

役割を分けることで：

- **ルーティング**だけを変更すれば、URLの構成を変えられる
- **モデル**だけを変更すれば、データの取得方法を変えられる
- **ビュー**だけを変更すれば、画面のデザインを変えられる

それぞれの担当が独立しているので、**一箇所を変えても他に影響しない**のです。

---

## ✨ まとめ

このセクションでは、MVCの概念を居酒屋の比喩で学びました。

| 居酒屋の役割 | 専門用語 | やること |
|:---|:---|:---|
| タッチパネル | **ルーティング** | 注文を受け付け、担当のコントローラーに通知 |
| ホールスタッフ | **コントローラー** | リクエストの処理、モデルとビューの橋渡し |
| キッチン | **モデル** | データベースからのデータ取得・調理 |
| 盛り付け担当 | **ビュー** | HTMLの生成 |

> **📌 ポイント**
> 
> このセクションでは、MVCの**概念と流れ**を理解することが目的でした。
> 「ルーティングはタッチパネル」「コントローラーはホールスタッフ」「モデルはキッチン」というイメージを持っていれば大丈夫です。
> 
> また、Laravelは**「設定より規約」**という考え方を採用しています。
> ルールに従えば、設定ファイルを書かなくても自動的にうまくいきます。
> 
> 実際のコードの書き方は、次のセクション以降で詳しく学んでいきます。

次のセクションでは、MVCの最初のステップである「ルーティング」の実装方法を学びます。

---
