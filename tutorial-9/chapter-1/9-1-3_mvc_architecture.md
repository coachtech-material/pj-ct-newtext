# Tutorial 9-1-3: MVCアーキテクチャとディレクトリ構成

## 🎯 このセクションで学ぶこと

- MVCアーキテクチャ（Model-View-Controller）の概念を理解する
- Laravelにおける「データの流れ」を理解する
- 各役割に対応するディレクトリの場所を把握する

---

## MVCアーキテクチャとは

**MVC**とは、**Model（モデル）**、**View（ビュー）**、**Controller（コントローラー）**の頭文字を取ったもので、Webアプリケーションを**3つの役割に分けて設計する手法**です。

Laravelは、このMVCアーキテクチャを採用しています。

---

## 📦 3つの役割

### Model（モデル）

**役割**: データベースとのやり取りを担当する

モデルは、データベースのテーブルと対応し、**データの取得・作成・更新・削除**を行います。

例えば、「全てのユーザーを取得する」「新しいタスクを保存する」といった処理は、モデルが担当します。

---

### View（ビュー）

**役割**: ユーザーに表示する画面（HTML）を担当する

ビューは、コントローラーから受け取ったデータを使って、**HTMLを生成**します。

Laravelでは、**Bladeテンプレート**（`.blade.php`ファイル）を使ってビューを作成します。

---

### Controller（コントローラー）

**役割**: リクエストを受け取り、モデルとビューを橋渡しする

コントローラーは、ユーザーからのリクエストを受け取り、**処理の流れを制御**します。

具体的には、以下のような処理を行います：
1. モデルにデータの取得を依頼する
2. 取得したデータをビューに渡す
3. ビューが生成したHTMLをブラウザに返す

---

## 🔄 処理の流れ（詳細解説）

ユーザーがブラウザで「ユーザー一覧ページ」にアクセスした場合の処理の流れを、詳細に見ていきましょう。

### Step 1: ブラウザからリクエストを送信

ユーザーがブラウザのアドレスバーに`http://localhost/users`と入力し、Enterキーを押します。

この時、ブラウザは**GETリクエスト**をサーバーに送信します。GETリクエストとは、「このURLのページを見せてください」という要求のことです。

---

### Step 2: ルーティングがリクエストを受け取る

サーバーがリクエストを受け取ると、まず**ルーティング**が動作します。

> **✒️ 用語解説: ルーティング**
> 
> ルーティングとは、「どのURLにアクセスされたら、どの処理を実行するか」を定義する仕組みです。
> 
> 例えば、「`/users`にアクセスされたら、UserControllerのindexメソッドを実行する」といった対応付けを行います。

ルーティングは、`routes/web.php`ファイルに定義されています。

---

### Step 3: コントローラーが呼び出される

ルーティングの定義に従って、**コントローラー**が呼び出されます。

コントローラーは、リクエストを受け取り、「何をすべきか」を判断します。ユーザー一覧を表示する場合、コントローラーは「データベースからユーザーを取得して、画面に表示する」という処理を行います。

---

### Step 4: モデルにデータ取得を依頼

コントローラーは、自分でデータベースにアクセスするのではなく、**モデル**にデータの取得を依頼します。

モデルは、データベースとのやり取りを専門に担当する役割です。コントローラーが「全てのユーザーを取得して」と依頼すると、モデルがデータベースにアクセスしてデータを取得します。

---

### Step 5: データベースからデータを取得

モデルは、データベースに**SQLクエリ**を発行します。

> **✒️ 用語解説: SQLクエリ**
> 
> SQLクエリとは、データベースに対する命令文のことです。
> 
> 例えば、「全てのユーザーを取得する」場合は、`SELECT * FROM users`というSQLクエリが発行されます。

データベースは、SQLクエリを受け取り、該当するデータを返します。

---

### Step 6: モデルがデータをコントローラーに返す

モデルは、データベースから取得したデータを**PHPのオブジェクト**に変換し、コントローラーに返します。

この変換により、コントローラーはデータベースの構造を意識せずに、PHPのオブジェクトとしてデータを扱うことができます。

---

### Step 7: コントローラーがビューにデータを渡す

コントローラーは、モデルから受け取ったデータを**ビュー**に渡します。

ビューは、HTMLテンプレートにデータを埋め込んで、最終的なHTMLを生成します。

---

### Step 8: ビューがHTMLを生成

ビューは、コントローラーから受け取ったデータを使って、**HTMLを生成**します。

例えば、ユーザーの名前やメールアドレスを、HTMLのリストとして整形します。

---

### Step 9: ブラウザにHTMLが返される

生成されたHTMLがブラウザに返され、ユーザーの画面に**ユーザー一覧**が表示されます。

---

## 📁 関連するディレクトリの場所

MVCの各役割に対応するディレクトリは、以下の場所にあります。

```
src/
├── app/
│   ├── Http/Controllers/  ← Controller（コントローラー）
│   └── Models/            ← Model（モデル）
├── resources/
│   └── views/             ← View（ビュー）
└── routes/
    └── web.php            ← ルーティング
```

| 役割 | ディレクトリ | 説明 |
|:---|:---|:---|
| **ルーティング** | `routes/web.php` | URLとコントローラーの対応付け |
| **Controller** | `app/Http/Controllers/` | リクエストの処理 |
| **Model** | `app/Models/` | データベースとのやり取り |
| **View** | `resources/views/` | HTMLテンプレート |

---

## 🖥️ コードで見る処理の流れ

ここでは、実際のコードを使って処理の流れを確認します。

> **📌 注意**
> 
> ここでは**コードの雰囲気だけ**を掴んでください。
> 実際の実装方法は、次のセクション以降で詳しく学びます。

---

### ルーティング（routes/web.php）

```php
Route::get('/users', [UserController::class, 'index']);
```

**やっていること**: 「`/users`にアクセスされたら、UserControllerのindexメソッドを実行する」という対応付けを定義しています。

---

### コントローラー（app/Http/Controllers/UserController.php）

```php
public function index()
{
    $users = User::all();
    return view('users.index', compact('users'));
}
```

**やっていること**: 
1. モデル（User）に「全てのユーザーを取得して」と依頼
2. 取得したデータをビュー（users.index）に渡す

---

### モデル（app/Models/User.php）

```php
class User extends Model
{
    // User::all() で全てのユーザーを取得できる
}
```

**やっていること**: データベースの`users`テーブルと対応し、データの取得を担当しています。

---

### ビュー（resources/views/users/index.blade.php）

```html
@foreach ($users as $user)
    <p>{{ $user->name }}</p>
@endforeach
```

**やっていること**: コントローラーから受け取ったユーザーデータを、HTMLとして整形しています。

---

## 📊 処理の流れ（図解）

```
[ブラウザ]
   ↓ GET /users
[ルーティング (routes/web.php)]
   ↓ UserController@index を呼び出す
[Controller (UserController.php)]
   ↓ User::all() を呼び出す
[Model (User.php)]
   ↓ SELECT * FROM users を実行
[データベース (MySQL)]
   ↑ ユーザーデータを返す
[Model (User.php)]
   ↑ データをオブジェクトに変換して返す
[Controller (UserController.php)]
   ↓ view('users.index', compact('users')) を呼び出す
[View (users/index.blade.php)]
   ↓ HTMLを生成
[ブラウザ]
   ← HTMLが表示される
```

---

## 🧩 MVCの役割分担のメリット

MVCアーキテクチャで役割を分けることで、以下のようなメリットがあります。

### 1. 変更の影響範囲が限定される

例えば、「ユーザー一覧の表示を、リストからテーブル形式に変更したい」という場合、変更するのは**ビューだけ**です。コントローラーやモデルを触る必要はありません。

逆に、「データベースのテーブル構造を変更したい」という場合は、**モデルだけ**を修正すれば、コントローラーやビューには影響しません。

### 2. コードの再利用性が高まる

同じモデルを、複数のコントローラーやビューで使い回すことができます。

### 3. チーム開発がしやすくなる

デザイナーはビューを担当し、バックエンドエンジニアはコントローラーとモデルを担当する、といった役割分担が明確になります。

---

## 💡 TIP: 迷ったらこの順番で探す

開発中に「このファイルはどこ？」と迷ったら、以下の順番で探してみてください。

| やりたいこと | 探す場所 |
|:---|:---|
| URLを追加したい | `routes/web.php` |
| 処理を書きたい | `app/Http/Controllers/` |
| データベースを操作したい | `app/Models/` |
| 画面を作りたい | `resources/views/` |

---

## ✨ まとめ

このセクションでは、MVCアーキテクチャの概念と、Laravelにおけるデータの流れを学びました。

| 役割 | 担当 | ディレクトリ |
|:---|:---|:---|
| **ルーティング** | URLとコントローラーの対応付け | `routes/web.php` |
| **Controller** | リクエストの処理、モデルとビューの橋渡し | `app/Http/Controllers/` |
| **Model** | データベースとのやり取り | `app/Models/` |
| **View** | HTMLの生成 | `resources/views/` |

> **📌 ポイント**
> 
> このセクションでは、MVCの**概念と流れ**を理解することが目的です。
> 実際のコードの書き方は、次のセクション以降で詳しく学んでいきます。

次のセクションでは、MVCの最初のステップである「ルーティング」について、より詳しく学んでいきます。

---
