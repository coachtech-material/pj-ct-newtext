# Tutorial 9-1-3: Laravelのディレクトリ構成

## 🎯 このセクションで学ぶこと

*   Laravelプロジェクトのディレクトリ構成を理解し、各ディレクトリの役割を説明できるようになる。
*   どのファイルをどこに配置すべきか、Laravelの「規約」を理解する。
*   開発時に頻繁に触るディレクトリと、触らないディレクトリを区別できるようになる。

---

## 導入：ディレクトリ構成を理解する重要性

前のセクションで、Laravelプロジェクトを作成し、ブラウザでウェルカム画面を表示することができました。しかし、`src`ディレクトリの中を見ると、大量のフォルダとファイルが存在しており、「どこから手を付ければいいのか分からない...」と感じるかもしれません。

Laravelは、「設定より規約（Convention over Configuration）」という哲学を採用しています。これは、「細かい設定をするよりも、決められたルール（規約）に従ってファイルを配置すれば、自動的に動作する」という考え方です。

このセクションでは、Laravelのディレクトリ構成を一つずつ確認し、「どのディレクトリが何の役割を持っているのか」を理解していきましょう。全てを一度に覚える必要はありません。開発を進めていく中で、自然と覚えていくものです。

---

## 詳細解説

### 📁 Laravelプロジェクトのルートディレクトリ

Laravelプロジェクトのルートディレクトリ（`src`ディレクトリ）には、以下のようなディレクトリとファイルが存在します。

```
src/
├── app/              # アプリケーションのコアロジック
├── bootstrap/        # フレームワークの起動処理
├── config/           # 設定ファイル
├── database/         # マイグレーション、シーダー、ファクトリー
├── public/           # 公開ディレクトリ（Webサーバーのドキュメントルート）
├── resources/        # ビュー、CSS、JSなどのリソース
├── routes/           # ルーティング定義
├── storage/          # ログ、キャッシュ、アップロードファイル
├── tests/            # テストコード
├── vendor/           # Composerでインストールした依存パッケージ
├── .env              # 環境変数（データベース接続情報など）
├── artisan           # Laravelのコマンドラインツール
├── composer.json     # Composerの依存関係定義
└── composer.lock     # Composerの依存関係のロックファイル
```

これらのディレクトリの中で、開発時に**頻繁に触るディレクトリ**と、**ほとんど触らないディレクトリ**があります。まずは、頻繁に触るディレクトリから見ていきましょう。

---

### 🔥 頻繁に触るディレクトリ

#### 1. `app/` - アプリケーションのコアロジック

`app`ディレクトリは、あなたが書くコードの大部分が格納される場所です。Laravelのビジネスロジック、データベースモデル、コントローラーなどが全てここに配置されます。

```
app/
├── Console/          # Artisanコマンド
├── Exceptions/       # 例外ハンドラー
├── Http/
│   ├── Controllers/  # コントローラー（リクエストを処理）
│   ├── Middleware/   # ミドルウェア（リクエストの前後処理）
│   └── Requests/     # フォームリクエスト（バリデーション）
├── Models/           # Eloquentモデル（データベースのテーブルと対応）
└── Providers/        # サービスプロバイダー
```

**特に重要なディレクトリ**

*   **`app/Http/Controllers/`**: コントローラーを配置します。コントローラーは、URLへのアクセスを受け取り、処理を行い、ビューを返す役割を持ちます。
*   **`app/Models/`**: Eloquentモデルを配置します。モデルは、データベースのテーブルと1対1で対応し、データの取得・作成・更新・削除を行います。

#### 2. `routes/` - ルーティング定義

`routes`ディレクトリには、URLとコントローラーを紐付ける「ルーティング」を定義するファイルが格納されています。

```
routes/
├── web.php       # Webアプリケーションのルート（セッション、CSRF保護あり）
├── api.php       # APIのルート（セッションなし、トークン認証）
├── console.php   # Artisanコマンドのルート
└── channels.php  # ブロードキャストチャンネルのルート
```

**特に重要なファイル**

*   **`routes/web.php`**: 通常のWebアプリケーションのルートを定義します。このファイルに、「`/users`にアクセスしたら、`UserController`の`index`メソッドを実行する」といった定義を書きます。
*   **`routes/api.php`**: REST APIのルートを定義します。API開発では、このファイルを主に使います。

#### 3. `resources/views/` - ビュー（テンプレート）

`resources/views`ディレクトリには、HTMLテンプレート（Bladeファイル）を配置します。

```
resources/
└── views/
    ├── welcome.blade.php  # ウェルカム画面
    └── ...
```

Bladeファイルは、`.blade.php`という拡張子を持ち、HTMLの中にPHPのコードを埋め込むことができます。

#### 4. `database/` - マイグレーション、シーダー、ファクトリー

`database`ディレクトリには、データベース関連のファイルが格納されています。

```
database/
├── migrations/   # マイグレーションファイル（テーブル定義）
├── seeders/      # シーダー（初期データ投入）
└── factories/    # ファクトリー（テストデータ生成）
```

*   **`migrations/`**: データベースのテーブル構造を定義するファイルを配置します。マイグレーションを使うことで、チーム全員が同じテーブル構造を共有できます。
*   **`seeders/`**: 開発用の初期データを投入するファイルを配置します。
*   **`factories/`**: テスト用のダミーデータを生成するファイルを配置します。

#### 5. `config/` - 設定ファイル

`config`ディレクトリには、Laravelの各種設定ファイルが格納されています。

```
config/
├── app.php       # アプリケーション全体の設定
├── database.php  # データベース接続の設定
├── auth.php      # 認証の設定
└── ...
```

基本的には`.env`ファイルで環境変数を設定すれば動作しますが、より詳細な設定が必要な場合にこのディレクトリのファイルを編集します。

---

### 🔒 ほとんど触らないディレクトリ

#### 1. `vendor/` - Composerの依存パッケージ

`vendor`ディレクトリには、Composerでインストールした外部パッケージが格納されています。このディレクトリは**絶対に手動で編集してはいけません**。Composerが自動で管理します。

また、このディレクトリは`.gitignore`に含まれており、Gitで管理されません。他の開発者は、`composer install`コマンドで同じパッケージをインストールします。

#### 2. `bootstrap/` - フレームワークの起動処理

`bootstrap`ディレクトリには、Laravelフレームワークの起動処理が格納されています。通常、このディレクトリを触ることはありません。

#### 3. `storage/` - ログ、キャッシュ、アップロードファイル

`storage`ディレクトリには、Laravelが自動生成するファイル（ログ、キャッシュ、セッション、アップロードされたファイル）が格納されています。

```
storage/
├── app/          # アップロードされたファイル
├── framework/    # フレームワークが使うキャッシュ、セッション
└── logs/         # ログファイル
```

このディレクトリも`.gitignore`に含まれており、Gitで管理されません。

#### 4. `public/` - 公開ディレクトリ

`public`ディレクトリは、Webサーバーのドキュメントルートに設定されるディレクトリです。このディレクトリの中にあるファイルだけが、外部から直接アクセスできます。

```
public/
├── index.php     # Laravelのエントリーポイント
├── .htaccess     # Apacheの設定（Nginxでは不要）
└── ...
```

*   **`index.php`**: 全てのHTTPリクエストは、このファイルを経由してLaravelに渡されます。このファイルを編集することはほとんどありません。
*   画像、CSS、JavaScriptなどの静的ファイルは、このディレクトリに配置します。

---

### 🔑 重要なファイル

#### 1. `.env` - 環境変数

`.env`ファイルは、環境ごとに異なる設定（データベース接続情報、APIキーなど）を記述するファイルです。

```env
APP_NAME=Laravel
APP_ENV=local
APP_KEY=base64:...
APP_DEBUG=true
APP_URL=http://localhost

DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=laravel_db
DB_USERNAME=laravel_user
DB_PASSWORD=laravel_pass
```

このファイルは`.gitignore`に含まれており、Gitで管理されません。本番環境と開発環境で異なる設定を持つことができます。

#### 2. `artisan` - Laravelのコマンドラインツール

`artisan`は、Laravelのコマンドラインツールです。マイグレーションの実行、コントローラーの生成、キャッシュのクリアなど、様々な操作をコマンドで実行できます。

```bash
# 例：マイグレーションを実行
php artisan migrate

# 例：コントローラーを生成
php artisan make:controller UserController
```

Docker環境では、以下のように実行します。

```bash
docker compose exec php php artisan migrate
```

#### 3. `composer.json` - Composerの依存関係定義

`composer.json`は、プロジェクトが依存する外部パッケージを定義するファイルです。

```json
{
    "require": {
        "php": "^8.1",
        "laravel/framework": "^10.0"
    }
}
```

新しいパッケージをインストールする場合は、`composer require`コマンドを使います。

```bash
composer require laravel/fortify
```

---

## 💡 TIP: ディレクトリ構成は「慣れ」が大事

最初は、どのファイルがどこにあるのか分からず、混乱するかもしれません。しかし、開発を進めていく中で、自然と「コントローラーは`app/Http/Controllers/`に配置する」「ルートは`routes/web.php`に書く」といったことが身についていきます。

今は全てを覚える必要はありません。このセクションを、必要な時に見返す「辞書」として使ってください。

---

## ✨ まとめ

このセクションでは、Laravelのディレクトリ構成を学びました。

*   Laravelは「設定より規約」の哲学を採用しており、決められた場所にファイルを配置することで、自動的に動作する。
*   **頻繁に触るディレクトリ**は、`app/`（コントローラー、モデル）、`routes/`（ルーティング）、`resources/views/`（ビュー）、`database/`（マイグレーション）、`config/`（設定）。
*   **ほとんど触らないディレクトリ**は、`vendor/`（依存パッケージ）、`bootstrap/`（起動処理）、`storage/`（ログ、キャッシュ）、`public/`（公開ディレクトリ）。
*   `.env`ファイルは環境変数を定義し、`artisan`はLaravelのコマンドラインツールとして使われる。

次のセクションでは、Laravelの設計思想である「MVCアーキテクチャ」について学び、Model、View、Controllerがどのように連携してWebアプリケーションを構成するのかを理解していきます。

---
