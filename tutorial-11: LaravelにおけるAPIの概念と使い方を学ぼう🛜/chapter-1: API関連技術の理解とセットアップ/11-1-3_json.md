# Tutorial 11-1-3: JSONとは

## 🎯 このセクションで学ぶこと

- JSONとは何かを理解する
- JSONの構造と書き方を学ぶ
- PHPでJSONを扱う方法を学ぶ
- APIでJSONを使う理由を理解する

---

## 🧠 先輩エンジニアの思考プロセス

### 「なぜ環境構築の後に『JSON』を学ぶのか？」

環境が整ったら、次は「JSON」です。

---

### 理由1: APIの共通言語

APIでは、データを**JSON形式**でやり取りします。

```json
{
    "id": 1,
    "title": "タスク1",
    "completed": false
}
```

JSONを理解しないと、APIの開発はできません。

---

### 理由2: フロントエンドとの連携

JavaScriptは**JSONをネイティブにサポート**しています。

フロントエンドとバックエンドの連携には、JSONが最適です。

---

### 理由3: LaravelでのJSON操作

Laravelでは、**簡単にJSONレスポンスを返せる**ようになっています。

```php
return response()->json(['message' => 'Hello']);
```

---

### このセクションでやること

| 順番 | 作業 | 理由 |
|------|------|------|
| Step 1 | JSON形式の理解 | 構文と特徴を学ぶ |
| Step 2 | PHPでのJSON操作 | `json_encode()`と`json_decode()` |
| Step 3 | LaravelでのJSON操作 | `response()->json()`の使い方 |

> 💡 **ポイント**: JSONは「JavaScript Object Notation」の略で、軽量なデータ交換形式です。

---

## Step 1: JSONの基礎

### 1-1. JSONとは

**JSON（JavaScript Object Notation）**は、**データを表現するための形式**です。

JSONを身近な例で説明すると、「**名刺**」のようなものです。名刺には「名前」「会社名」「電話番号」「メールアドレス」などの情報が整理されて書かれています。JSONも同じように、データを「項目名（キー）」と「値」のペアで整理して表現します。

| 特徴 | 説明 | 具体例 |
|------|------|--------|
| 軽量 | データサイズが小さい | XMLと比べて約30%軽量 |
| 読みやすい | 人間が読みやすい形式 | `{"name": "田中"}` |
| 言語に依存しない | どのプログラミング言語でも扱える | PHP、JavaScript、Python等 |

**なぜJSONが選ばれるのか？**

以前は「XML」という形式がよく使われていましたが、JSONの方がシンプルで軽量なため、現在のAPI開発ではJSONが主流になっています。

```xml
<!-- XML形式（冗長） -->
<user>
  <name>田中太郎</name>
  <age>30</age>
</user>
```

```json
// JSON形式（シンプル）
{
  "name": "田中太郎",
  "age": 30
}
```

---

### 1-2. JSONの構造

JSONは、**キーと値のペア**で構成されます。

```json
{
  "name": "田中太郎",
  "age": 30,
  "email": "tanaka@example.com"
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `{` | オブジェクトの開始を示します。JSONデータは必ず `{` で始まります |
| `"name"` | **キー**です。データの項目名を表します。必ずダブルクォーテーションで囲みます |
| `:` | キーと値を区切る記号です |
| `"田中太郎"` | **値**です。文字列の場合はダブルクォーテーションで囲みます |
| `,` | 複数のキーと値のペアを区切る記号です |
| `30` | 数値の値です。数値はダブルクォーテーションで囲みません |
| `}` | オブジェクトの終了を示します |

**構文解説: JSONの基本ルール**

| ルール | 説明 | 正しい例 | 間違い例 |
|--------|------|----------|----------|
| キーの囲み | ダブルクォーテーション（`"`）で囲む | `"name"` | `'name'` や `name` |
| 区切り | キーと値はコロン（`:`）で区切る | `"name": "田中"` | `"name" = "田中"` |
| 複数のペア | カンマ（`,`）で区切る | `"a": 1, "b": 2` | `"a": 1; "b": 2` |
| 最後のカンマ | 最後のペアの後にカンマは不要 | `"a": 1, "b": 2` | `"a": 1, "b": 2,` |

---

### 1-3. JSONのデータ型

JSONで使えるデータ型は6種類です。それぞれの特徴を理解しましょう。

| データ型 | 説明 | 例 |
|----------|------|-----|
| 文字列 | テキストデータ。ダブルクォーテーションで囲む | `"name": "田中太郎"` |
| 数値 | 整数または小数。クォーテーションなし | `"age": 30` |
| 真偽値 | `true`または`false`。クォーテーションなし | `"is_active": true` |
| null | 値がないことを表す。クォーテーションなし | `"description": null` |
| 配列 | 複数の値をまとめる。`[]`で囲む | `"tags": ["PHP", "Laravel"]` |
| オブジェクト | キーと値のペアをまとめる。`{}`で囲む | `"user": {"name": "田中"}` |

**構文解説: 各データ型の書き方**

```json
{
  "string_example": "これは文字列です",
  "number_integer": 42,
  "number_float": 3.14,
  "boolean_true": true,
  "boolean_false": false,
  "null_value": null,
  "array_example": ["apple", "banana", "cherry"],
  "object_example": {
    "nested_key": "nested_value"
  }
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `"string_example": "これは文字列です"` | 文字列は必ずダブルクォーテーションで囲みます |
| `"number_integer": 42` | 整数はそのまま書きます（クォーテーション不要） |
| `"number_float": 3.14` | 小数もそのまま書きます |
| `"boolean_true": true` | 真偽値は`true`または`false`を小文字で書きます |
| `"null_value": null` | nullは小文字で書きます |
| `["apple", "banana", "cherry"]` | 配列は`[]`で囲み、要素をカンマで区切ります |
| `{"nested_key": "nested_value"}` | オブジェクトは`{}`で囲みます |

---

### 1-4. JSONの例

**タスクのデータ**:

```json
{
  "id": 1,
  "title": "Laravelを学ぶ",
  "description": "Tutorial 11を完了する",
  "status": "pending",
  "priority": 3,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `"id": 1` | タスクの一意な識別子（数値） |
| `"title": "Laravelを学ぶ"` | タスクのタイトル（文字列） |
| `"description": "Tutorial 11を完了する"` | タスクの詳細説明（文字列） |
| `"status": "pending"` | タスクの状態（文字列）。`pending`は「未着手」を意味します |
| `"priority": 3` | 優先度（数値）。数字が大きいほど優先度が高いなどのルールを決めます |
| `"created_at": "2024-01-01T00:00:00Z"` | 作成日時。ISO 8601形式で表現します |
| `"updated_at": "2024-01-01T00:00:00Z"` | 更新日時。ISO 8601形式で表現します |

> 💡 **ISO 8601形式とは**: 日時を表す国際標準形式です。`T`は日付と時刻の区切り、`Z`はUTC（協定世界時）を意味します。

---

### 1-5. 配列を含むJSON

複数のタスクをまとめて表現する場合は、配列を使います。

```json
{
  "tasks": [
    {
      "id": 1,
      "title": "Laravelを学ぶ",
      "status": "pending"
    },
    {
      "id": 2,
      "title": "APIを実装する",
      "status": "in_progress"
    }
  ]
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `"tasks": [...]` | `tasks`というキーに配列を割り当てています |
| `[...]` | 配列の開始と終了を示します |
| `{...}, {...}` | 配列の中に複数のオブジェクトが入っています。各オブジェクトはカンマで区切ります |

**処理の流れ**

1. `tasks`キーで配列にアクセス
2. 配列の各要素（オブジェクト）を順番に処理
3. 各オブジェクトから`id`、`title`、`status`などを取得

---

### 1-6. ネストしたJSON

JSONはオブジェクトの中にオブジェクトを入れる（ネストする）ことができます。

```json
{
  "user": {
    "id": 1,
    "name": "田中太郎",
    "tasks": [
      {"id": 1, "title": "Laravelを学ぶ"},
      {"id": 2, "title": "APIを実装する"}
    ]
  }
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `"user": {...}` | `user`キーにオブジェクトを割り当てています |
| `"tasks": [...]` | `user`オブジェクトの中に`tasks`配列があります |
| `{"id": 1, "title": "Laravelを学ぶ"}` | `tasks`配列の中にオブジェクトが入っています |

**データへのアクセス方法（イメージ）**

- ユーザー名: `user` → `name` → `"田中太郎"`
- 1つ目のタスク: `user` → `tasks` → `[0]` → `{"id": 1, "title": "Laravelを学ぶ"}`

---

## Step 2: PHPでJSONを扱う

PHPでは、`json_encode()`と`json_decode()`という2つの関数を使ってJSONを扱います。

### 2-1. 配列をJSONに変換（json_encode）

**`json_encode()`**は、PHPの配列をJSON文字列に変換する関数です。

```php
$data = [
    'name' => '田中太郎',
    'age' => 30,
    'email' => 'tanaka@example.com',
];

$json = json_encode($data);
echo $json;
// 出力: {"name":"田中太郎","age":30,"email":"tanaka@example.com"}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `$data = [...]` | PHPの連想配列を定義しています |
| `'name' => '田中太郎'` | PHPではキーをシングルクォーテーションで囲むことができます |
| `json_encode($data)` | 配列をJSON文字列に変換します |
| `echo $json;` | 変換されたJSON文字列を出力します |

**構文解説: json_encode()**

```php
json_encode(mixed $value, int $flags = 0, int $depth = 512): string|false
```

| 引数 | 説明 |
|:---|:---|
| `$value` | 変換したい値（配列やオブジェクト） |
| `$flags` | オプションフラグ（後述） |
| `$depth` | ネストの最大深度（デフォルト512） |

---

### 2-2. JSONを配列に変換（json_decode）

**`json_decode()`**は、JSON文字列をPHPの配列やオブジェクトに変換する関数です。

```php
$json = '{"name":"田中太郎","age":30,"email":"tanaka@example.com"}';

$data = json_decode($json, true);
print_r($data);
// 出力: Array ( [name] => 田中太郎 [age] => 30 [email] => tanaka@example.com )
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `$json = '...'` | JSON文字列を変数に代入しています |
| `json_decode($json, true)` | JSON文字列をPHPの連想配列に変換します |
| `true` | 第2引数に`true`を指定すると連想配列に変換されます |
| `print_r($data)` | 配列の内容を出力します |

**構文解説: json_decode()**

```php
json_decode(string $json, ?bool $associative = null, int $depth = 512, int $flags = 0): mixed
```

| 引数 | 説明 |
|:---|:---|
| `$json` | 変換したいJSON文字列 |
| `$associative` | `true`で連想配列、`false`または`null`でオブジェクトに変換 |
| `$depth` | ネストの最大深度 |
| `$flags` | オプションフラグ |

**第2引数の違い**

```php
// true: 連想配列に変換
$array = json_decode($json, true);
echo $array['name']; // 田中太郎

// false または 省略: オブジェクトに変換
$object = json_decode($json);
echo $object->name; // 田中太郎
```

---

### 2-3. JSONの整形（JSON_PRETTY_PRINT）

`json_encode()`の第2引数に`JSON_PRETTY_PRINT`を指定すると、読みやすく整形されたJSONが出力されます。

```php
$data = [
    'name' => '田中太郎',
    'age' => 30,
];

$json = json_encode($data, JSON_PRETTY_PRINT);
echo $json;
```

**出力**:

```json
{
    "name": "田中太郎",
    "age": 30
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `JSON_PRETTY_PRINT` | PHPの定数です。JSONを整形して出力するオプションを指定します |
| インデント | 整形されたJSONは、ネストに応じてインデント（字下げ）されます |

---

### 2-4. 日本語を含むJSON（JSON_UNESCAPED_UNICODE）

デフォルトでは、日本語などの非ASCII文字はエスケープ（`\uXXXX`形式）されます。

```php
$data = ['name' => '田中太郎'];

// JSON_UNESCAPED_UNICODEなし
echo json_encode($data);
// 出力: {"name":"\u7530\u4e2d\u592a\u90ce"}

// JSON_UNESCAPED_UNICODEあり
echo json_encode($data, JSON_UNESCAPED_UNICODE);
// 出力: {"name":"田中太郎"}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `\u7530\u4e2d\u592a\u90ce` | 日本語がUnicodeエスケープされた形式です |
| `JSON_UNESCAPED_UNICODE` | 日本語をエスケープせずにそのまま出力するオプションです |

**複数のオプションを組み合わせる**

```php
$json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
```

`|`（パイプ）を使って複数のオプションを組み合わせることができます。

---

## Step 3: LaravelでJSONを返す

### 3-1. 基本的な使い方

Laravelでは、`response()->json()`を使って簡単にJSONレスポンスを返せます。

```php
public function index()
{
    $tasks = Task::all();
    return response()->json($tasks);
}
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `Task::all()` | Taskモデルの全レコードを取得します |
| `response()` | Laravelのレスポンスヘルパー関数です |
| `->json($tasks)` | 引数をJSON形式に変換してレスポンスを返します |

**構文解説: response()->json()**

```php
response()->json(mixed $data = [], int $status = 200, array $headers = [], int $options = 0)
```

| 引数 | 説明 |
|:---|:---|
| `$data` | JSONに変換するデータ |
| `$status` | HTTPステータスコード（デフォルト200） |
| `$headers` | 追加のHTTPヘッダー |
| `$options` | `json_encode()`のオプション |

**処理の流れ**

1. `Task::all()`でデータベースからタスクを取得
2. `response()->json()`で取得したデータをJSON形式に変換
3. `Content-Type: application/json`ヘッダーが自動的に設定される
4. クライアント（ブラウザやAPIクライアント）にJSONレスポンスを返す

---

### 3-2. 出力例

```json
[
  {
    "id": 1,
    "title": "Laravelを学ぶ",
    "description": "Tutorial 11を完了する",
    "status": "pending",
    "priority": 3,
    "created_at": "2024-01-01T00:00:00.000000Z",
    "updated_at": "2024-01-01T00:00:00.000000Z"
  }
]
```

---

### 3-3. ステータスコードを指定する

```php
// 201 Created（リソース作成成功）
return response()->json($task, 201);

// 404 Not Found（リソースが見つからない）
return response()->json(['error' => 'Task not found'], 404);
```

**コードリーディング**

| コード | 説明 |
|:---|:---|
| `response()->json($task, 201)` | 第2引数でHTTPステータスコードを指定します |
| `201` | リソースが正常に作成されたことを示すステータスコードです |
| `404` | リソースが見つからないことを示すステータスコードです |

---

### 3-4. 実践演習

以下のデータをJSON形式で表現してください。

**データ**:

- ユーザー名: 山田花子
- 年齢: 25
- メールアドレス: yamada@example.com
- タスク: ["買い物", "掃除", "料理"]

**解答例**:

```json
{
  "name": "山田花子",
  "age": 25,
  "email": "yamada@example.com",
  "tasks": ["買い物", "掃除", "料理"]
}
```

**解説**

| キー | 値 | データ型 |
|:---|:---|:---|
| `name` | `"山田花子"` | 文字列 |
| `age` | `25` | 数値 |
| `email` | `"yamada@example.com"` | 文字列 |
| `tasks` | `["買い物", "掃除", "料理"]` | 配列（文字列の配列） |

---

## 🚨 よくある間違い

### 間違い1: キーをシングルクォーテーションで囲む

**問題**: JSONでは、キーは**ダブルクォーテーション**で囲みます。

```json
// ❌ 間違い
{
  'name': '田中太郎'
}

// ✅ 正しい
{
  "name": "田中太郎"
}
```

**対処法**: JSONではシングルクォーテーションは使えません。必ずダブルクォーテーションを使いましょう。

> 💡 **PHPとの違い**: PHPではシングルクォーテーションもダブルクォーテーションも使えますが、JSONではダブルクォーテーションのみです。

---

### 間違い2: 最後のカンマ（トレイリングカンマ）

**問題**: JSONでは、最後のカンマは不要です。

```json
// ❌ 間違い
{
  "name": "田中太郎",
  "age": 30,
}

// ✅ 正しい
{
  "name": "田中太郎",
  "age": 30
}
```

**対処法**: 最後の要素の後にはカンマを付けないようにしましょう。

> 💡 **JavaScriptとの違い**: JavaScriptではトレイリングカンマが許可されていますが、JSONでは許可されていません。

---

### 間違い3: コメントを書く

**問題**: JSONでは、コメントは書けません。

```json
// ❌ 間違い
{
  "name": "田中太郎", // 名前
  "age": 30
}

// ✅ 正しい
{
  "name": "田中太郎",
  "age": 30
}
```

**対処法**: コメントを残したい場合は、別途ドキュメントを作成するか、`_comment`のようなキーを使う方法があります（推奨はされません）。

---

### 間違い4: json_decode()の第2引数を忘れる

**問題**: `json_decode()`の第2引数を省略すると、オブジェクトが返されます。

```php
// ❌ 配列として扱おうとしてエラー
$data = json_decode($json);
echo $data['name']; // エラー！

// ✅ 第2引数にtrueを指定
$data = json_decode($json, true);
echo $data['name']; // 田中太郎
```

**対処法**: 連想配列として扱いたい場合は、必ず第2引数に`true`を指定しましょう。

---

## 💡 TIP: JSONの検証ツール

JSONが正しい形式かどうかを確認するには、以下のツールが便利です。

- [JSONLint](https://jsonlint.com/) - JSONの構文チェック
- [JSON Formatter](https://jsonformatter.org/) - JSONの整形と検証

これらのツールを使うと、JSONの構文エラーを簡単に見つけることができます。

---

## ✨ まとめ

このセクションでは、JSONについて学びました。

| Step | 学んだこと |
|------|-----------|
| Step 1 | JSONの構造とデータ型（キーと値のペア、6つのデータ型） |
| Step 2 | PHPでのJSON操作（`json_encode()`と`json_decode()`） |
| Step 3 | LaravelでJSONを返す方法（`response()->json()`） |

**重要なポイント**

- JSONはキーと値のペアでデータを表現する
- キーは必ずダブルクォーテーションで囲む
- PHPでは`json_encode()`で配列→JSON、`json_decode()`でJSON→配列に変換
- Laravelでは`response()->json()`で簡単にJSONレスポンスを返せる

次のセクションでは、API開発ツールについて学びます。

---
